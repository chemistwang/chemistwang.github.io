<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Chemputer Blog"><meta property="og:type" content="article"><meta property="og:image" content="https://chemistwang.github.io//img/home-bg.jpg"><meta property="twitter:image" content="https://chemistwang.github.io//img/home-bg.jpg"><meta name=title content="JSä½“ç³»ä¹‹å››ã€äº‹ä»¶å¾ªç¯ã€‘"><meta property="og:title" content="JSä½“ç³»ä¹‹å››ã€äº‹ä»¶å¾ªç¯ã€‘"><meta property="twitter:title" content="JSä½“ç³»ä¹‹å››ã€äº‹ä»¶å¾ªç¯ã€‘"><meta name=description content="å¾ˆé‡è¦"><meta property="og:description" content="å¾ˆé‡è¦"><meta property="twitter:description" content="å¾ˆé‡è¦"><meta property="twitter:card" content="summary"><meta name=keyword content="æ±ªæ´‹é¾™, wangyanglong, Wangyanglong, æ±ªæ´‹é¾™çš„åšå®¢, Wangyanglong Blog, åšå®¢, ä¸ªäººç½‘ç«™, äº’è”ç½‘, Web, Javascript, React"><link rel="shortcut icon" href=/img/favicon.ico><title>JSä½“ç³»ä¹‹å››ã€äº‹ä»¶å¾ªç¯ã€‘ | æ±ªæ´‹é¾™çš„åšå®¢ | Wangyanglong Blog</title><link rel=canonical href=/post/js/event-loop/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link href=https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css rel=stylesheet type=text/css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>Chemputer Blog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/categories/es6>es6</a></li><li><a href=/categories/react>react</a></li><li><a href=/categories/tech>tech</a></li><li><a href=/archive/>ARCHIVE</a></li><li><a href=/notes/>NOTES</a></li><li><a href=/about/>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/coffee-bg.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>JSä½“ç³»ä¹‹å››ã€äº‹ä»¶å¾ªç¯ã€‘</h1><h2 class=subheading></h2><span class=meta>Posted by
æ±ªæ´‹é¾™
on
Wednesday, August 31, 2022</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><h1 id=äº‹ä»¶å¾ªç¯>äº‹ä»¶å¾ªç¯</h1><p>æ¨èä¸‹é¢è¿™ä¸ªè§†é¢‘ï¼Œè®²çš„éå¸¸å¥½ã€‚</p><p><a href="https://www.bilibili.com/video/BV1XQ4y1P7L7?from=search&seid=4063426400438383115">JavaScriptä¸­çš„äº‹ä»¶å¾ªç¯ä»‹ç» -Jake Archibaldã€Bilibiliã€‘</a> ğŸ‘</p><p><a href="https://www.youtube.com/watch?v=cCOL7MC4Pl0&t=166s&ab_channel=JSConf">JavaScriptä¸­çš„äº‹ä»¶å¾ªç¯ä»‹ç» -Jake Archibaldã€YouTubeã€‘</a> ğŸ‘ˆ</p><p>è§†é¢‘æœ€åæœ‰ä¸€ä¸ªä¾‹å­ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> btn <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#39;btn&#39;</span>)
</span></span><span style=display:flex><span>btn.addEventListener(<span style=color:#f1fa8c>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; console.log(<span style=color:#f1fa8c>&#39;m1&#39;</span>))
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#39;listen 1&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btn.addEventListener(<span style=color:#f1fa8c>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; console.log(<span style=color:#f1fa8c>&#39;m2&#39;</span>))
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#39;listen 2&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// btn.click()
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> btn <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#39;btn&#39;</span>)
</span></span><span style=display:flex><span>btn.addEventListener(<span style=color:#f1fa8c>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; console.log(<span style=color:#f1fa8c>&#39;m1&#39;</span>))
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#39;listen 1&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btn.addEventListener(<span style=color:#f1fa8c>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; console.log(<span style=color:#f1fa8c>&#39;m2&#39;</span>))
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#39;listen 2&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btn.click()
</span></span></code></pre></div><p>ä¸å¦¨å…ˆè¯•è¯•ï¼Œçœ‹çœ‹è¾“å‡ºçš„å…·ä½“é¡ºåºï¼Œè§£æåœ¨ <code>ç»ƒä¹ 10</code>ã€‚</p><h2 id=å‰è¨€>å‰è¨€</h2><ul><li><strong>å•çº¿ç¨‹</strong>ï¼šè¿™ä¸ªæ¦‚å¿µå¾ˆé‡è¦ï¼Œå®ƒå†³å®šäº† <code>JS</code> çš„å¾ˆå¤šè¡Œä¸º</li><li><strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼š<code>Task Queues</code>ï¼Œæ—¢ç„¶æ˜¯å•çº¿ç¨‹ï¼Œæµè§ˆå™¨çš„ç‰¹æ®Šæ€§å†³å®šäº†é‡åˆ°é˜»å¡æ€§äº‹ä»¶ä¸èƒ½ç­‰å¾…âŒ›ï¸ã€‚æ€ä¹ˆåŠå‘¢ï¼Œä¸å¦¨æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œç¨åå¤„ç†</li></ul><h2 id=è¿è¡Œæœºåˆ¶>è¿è¡Œæœºåˆ¶</h2><ol><li>åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆï¼ˆ<code>execution context stack</code>ï¼‰</li><li>å¯¹äºå¼‚æ­¥ä»»åŠ¡ï¼Œä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œå­˜åœ¨ä»»åŠ¡é˜Ÿåˆ—ï¼ˆ<code>task queue</code>ï¼‰</li><li>ä»»åŠ¡é˜Ÿåˆ—åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯å®ä»»åŠ¡ï¼ˆ<code>macro task</code>ï¼‰å’Œå¾®ä»»åŠ¡ï¼ˆ<code>micro task</code>ï¼‰</li><li>åªæœ‰åŒæ­¥ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼Œå³æ‰§è¡Œæ ˆæ¸…ç©ºï¼Œæ‰ä¼šæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡</li><li>æ¸…ç©ºå®Œå½“å‰å¾®ä»»åŠ¡ï¼Œæ‰ä¼šå†å»æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œå¦‚ä¸‹ä»£ç </li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>for</span> (macroTask <span style=color:#ff79c6>of</span> macroTaskQueue) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// 1. Handle current MACRO-TASK
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    handleMacroTask();
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// 2. Handle all MICRO-TASK
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>for</span> (microTask <span style=color:#ff79c6>of</span> microTaskQueue) {
</span></span><span style=display:flex><span>        handleMicroTask(microTask);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=åè¯è§£é‡Š>åè¯è§£é‡Š</h2><h3 id=å®ä»»åŠ¡-macro-task>å®ä»»åŠ¡ (macro task)</h3><ul><li><code>XHR</code> å›è°ƒ</li><li>äº‹ä»¶å›è°ƒï¼ˆé¼ æ ‡é”®ç›˜äº‹ä»¶ï¼‰</li><li><code>setImmediate</code></li><li><code>setTimeout</code></li><li><code>setInterval</code></li><li>indexedDB æ•°æ®åº“æ“ä½œç­‰ I/O</li></ul><p><strong>è¯´æ˜</strong>ï¼š<code>setTimeout</code> çš„å»¶æ—¶å‚æ•°å§‹ç»ˆ <code>ç›¸å¯¹äºä¸»ç¨‹åºæ‰§è¡Œå®Œæ¯•çš„æ—¶é—´</code>ï¼Œå¹¶ä¸”å¤šä¸ª <code>setTimeout</code> æ‰§è¡Œçš„å…ˆåé¡ºåºä¹Ÿæ˜¯ç”±è¿™ä¸ªå»¶è¿Ÿæ—¶é—´å†³å®š</p><h3 id=å¾®ä»»åŠ¡-micro-task>å¾®ä»»åŠ¡ (micro task)</h3><ul><li><code>process.nextTick</code></li><li><code>Promise.then</code></li><li><code>MutationObserver</code></li></ul><h2 id=ç»ƒä¹ >ç»ƒä¹ </h2><h3 id=ç»ƒä¹ 1>ç»ƒä¹ 1</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// ä»£ç è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>console.log(<span style=color:#f1fa8c>&#34;global&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>setTimeout(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;timeout1&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>(<span style=color:#8be9fd;font-style:italic>function</span>(resolve) {
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;timeout1_promise&#34;</span>);
</span></span><span style=display:flex><span>    resolve();
</span></span><span style=display:flex><span>  }).then(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;timeout1_then&#34;</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>2000</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> (<span style=color:#8be9fd;font-style:italic>var</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>; i <span style=color:#ff79c6>&lt;=</span> <span style=color:#bd93f9>5</span>; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>  setTimeout(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>    console.log(i);
</span></span><span style=display:flex><span>  }, i <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>1000</span>);
</span></span><span style=display:flex><span>  console.log(i);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>(<span style=color:#8be9fd;font-style:italic>function</span>(resolve) {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;promise1&#34;</span>);
</span></span><span style=display:flex><span>  resolve();
</span></span><span style=display:flex><span>}).then(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;then1&#34;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>setTimeout(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;timeout2&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>(<span style=color:#8be9fd;font-style:italic>function</span>(resolve) {
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;timeout2_promise&#34;</span>);
</span></span><span style=display:flex><span>    resolve();
</span></span><span style=display:flex><span>  }).then(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;timeout2_then&#34;</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>1000</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>(<span style=color:#8be9fd;font-style:italic>function</span>(resolve) {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;promise2&#34;</span>);
</span></span><span style=display:flex><span>  resolve();
</span></span><span style=display:flex><span>}).then(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;then2&#34;</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// global
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 3
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 4
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 5
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// promise1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// promise2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// then1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// then2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 6
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// timeout2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// timeout2_promise
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// timeout2_then
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// timeout1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// timeout1_promise
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// timeout1_then
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 6
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 6
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 6
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 6
</span></span></span></code></pre></div><p><strong>è§£æ</strong>ï¼š<code>Promise</code>çš„å¼‚æ­¥ä½“ç°åœ¨<code>then</code>å’Œ<code>catch</code>ä¸­ï¼Œè€Œé‡Œé¢çš„ä»£ç æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥</p><p>ç¬¬<code>1</code>ä¸ªå¾ªç¯ï¼š</p><ul><li>global</li><li>æŒ‚èµ· <code>macroTask</code> setTimeout(&mldr;,2000)</li><li>æŒ‚èµ· <code>macroTask</code> setTimeout(&mldr;,1000)</li><li>1</li><li>æŒ‚èµ· <code>macroTask</code> setTimeout(&mldr;,2000)</li><li>2</li><li>æŒ‚èµ· <code>macroTask</code> setTimeout(&mldr;,3000)</li><li>3</li><li>æŒ‚èµ· <code>macroTask</code> setTimeout(&mldr;,4000)</li><li>4</li><li>æŒ‚èµ· <code>macroTask</code> setTimeout(&mldr;,5000)</li><li>5 (è¿™ä¸ªæ—¶å€™ i å·²ç»å˜æˆ 6 äº†)</li><li>promise1</li><li>æŒ‚èµ· <code>mircoTask</code> then1</li><li>æŒ‚èµ· <code>macroTask</code> setTimeout(&mldr;,1000)</li><li>promise2</li><li>æŒ‚èµ· <code>mircoTask</code> then2</li><li><code>done</code></li><li>å‘ç°ä¸Šè¿° <code>2</code> ä¸ª <code>microTask</code>ï¼Œé¡ºåºæ‰§è¡Œè¾“å‡º then1ã€then2</li></ul><p>ç¬¬<code>2</code>ä¸ªå¾ªç¯ï¼š</p><ul><li>å‘ç°forå¾ªç¯æŒ‚èµ·çš„setTimeout(&mldr;,1000)ï¼Œè¾“å‡º 6</li></ul><p>ç¬¬<code>3</code>ä¸ªå¾ªç¯ï¼š</p><ul><li>å‘ç°å€’æ•°ç¬¬äºŒä¸ªsetTimeout(&mldr;,1000)</li><li>timeout2</li><li>timeout2_promise</li><li>æŒ‚èµ· <code>microTask</code> timeout2_then</li><li><code>done</code></li><li>å‘ç°ä¸Šè¿° <code>1</code> ä¸ª <code>microTask</code>ï¼Œé¡ºåºæ‰§è¡Œè¾“å‡º timeout2_then</li></ul><p>ç¬¬<code>4</code>ä¸ªå¾ªç¯ï¼š</p><ul><li>å‘ç°ç¬¬ä¸€ä¸ªsetTimeout(&mldr;,2000)</li><li>timeout1</li><li>timeout1_promise</li><li>æŒ‚èµ· <code>microTask</code> timeout1_then</li><li><code>done</code></li><li>å‘ç°ä¸Šè¿° <code>1</code> ä¸ª <code>microTask</code>ï¼Œé¡ºåºæ‰§è¡Œè¾“å‡º timeout1_then</li></ul><p>ç¬¬<code>5</code>ä¸ªå¾ªç¯</p><ul><li>å‘ç°setTimeout(&mldr;,2000)ï¼Œæ‰§è¡Œè¾“å‡º 6</li><li><code>done</code></li></ul><p>ç¬¬<code>6</code>ä¸ªå¾ªç¯</p><ul><li>å‘ç°setTimeout(&mldr;,3000)ï¼Œæ‰§è¡Œè¾“å‡º 6</li><li><code>done</code></li></ul><p>ç¬¬<code>7</code>ä¸ªå¾ªç¯</p><ul><li>å‘ç°setTimeout(&mldr;,4000)ï¼Œæ‰§è¡Œè¾“å‡º 6</li><li><code>done</code></li></ul><p>ç¬¬<code>8</code>ä¸ªå¾ªç¯</p><ul><li>å‘ç°setTimeout(&mldr;,5000)ï¼Œæ‰§è¡Œè¾“å‡º 6</li><li><code>done</code></li></ul><hr><h3 id=ç»ƒä¹ 2>ç»ƒä¹ 2</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// ä»£ç è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> async1() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async1 start&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>await</span> async2();
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async1 end&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> async2() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async2&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;script start&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>setTimeout(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;setTimeout&#34;</span>);
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>async1();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;script end&#34;</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>//script start
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async1 start
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//script end
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async1 end
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//setTimeout
</span></span></span></code></pre></div><p><strong>è§£æ</strong>ï¼š<a href=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function#%E5%8F%82%E8%A7%81>MDN async å‡½æ•°</a> ğŸ‘ˆ</p><ul><li>await è¡¨è¾¾å¼ä¼šæš‚åœæ•´ä¸ª async å‡½æ•°æ‰§è¡Œè¿›ç¨‹å¹¶è®©å‡ºå…¶æ§åˆ¶æƒ</li><li>async å‡½æ•°ä¸€å®šä¼šè¿”å›ä¸€ä¸ª promise å¯¹è±¡ã€‚å¦‚æœä¸€ä¸ª async å‡½æ•°çš„è¿”å›å€¼çœ‹èµ·æ¥ä¸æ˜¯ promiseï¼Œé‚£ä¹ˆå®ƒå°†ä¼šè¢«éšå¼åœ°åŒ…è£…åœ¨ä¸€ä¸ª promise ä¸­ã€‚</li></ul><p>ä¸å¦¨å°†ä¸Šè¿°ä¾‹å­æ”¹å†™ä¸€ä¸‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> async1() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async1 start&#34;</span>);
</span></span><span style=display:flex><span>  async2().then(() =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;async1 end&#34;</span>);
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> async2() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async2&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;script start&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>setTimeout(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;setTimeout&#34;</span>);
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>async1();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;script end&#34;</span>);
</span></span></code></pre></div><hr><h3 id=ç»ƒä¹ 3>ç»ƒä¹ 3</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// ä»£ç è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> async1() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async1 start&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>await</span> async2();
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async1 end&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> async2() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async2&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;script start&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>setTimeout(() =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;setTimeout&#34;</span>);
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>async1();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>((resolve) =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;promise1&#34;</span>);
</span></span><span style=display:flex><span>  resolve();
</span></span><span style=display:flex><span>}).then(() =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;promise2&#34;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;script end&#34;</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// script start
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// async1 start
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// async2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// promise1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// script end
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// async1 end
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// promise2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// setTimeout
</span></span></span></code></pre></div><hr><h3 id=ç»ƒä¹ 4>ç»ƒä¹ 4</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// ä»£ç è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>setTimeout(() =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;setTimeout&#34;</span>);
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;t1&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fetch(<span style=color:#f1fa8c>&#34;http://localhost:8888&#34;</span>)
</span></span><span style=display:flex><span>  .then(<span style=color:#8be9fd;font-style:italic>function</span>(response) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> response.json();
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  .then(<span style=color:#8be9fd;font-style:italic>function</span>(myJson) {
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;myJson&#34;</span>);
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  .<span style=color:#ff79c6>catch</span>(<span style=color:#8be9fd;font-style:italic>function</span>(err) {
</span></span><span style=display:flex><span>    console.log(err);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;fetch zhi hou&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> async1() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async1 start&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>await</span> async2();
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async1 end&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>async1();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;t2&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>((resolve) =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;promise&#34;</span>);
</span></span><span style=display:flex><span>  resolve();
</span></span><span style=display:flex><span>}).then(() =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;promise.then&#34;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;t3&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> async2() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async2&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;t4&#34;</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>//t1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//fetch zhi hou
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async1 start
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//t2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//promise
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//t3
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//t4
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async1 end
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//promise.then
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//setTimeout
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//myJson
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//error
</span></span></span></code></pre></div><hr><h3 id=ç»ƒä¹ 5>ç»ƒä¹ 5</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// ä»£ç è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> promise <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>((resolve, reject) =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>  resolve();
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>2</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>promise.then(() =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>3</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#bd93f9>4</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>//1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//4
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//3
</span></span></span></code></pre></div><hr><h3 id=ç»ƒä¹ 6>ç»ƒä¹ 6</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// ä»£ç è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>console.log(<span style=color:#f1fa8c>&#34;script start&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>setTimeout(() =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;setTimeout...&#34;</span>);
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>2000</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>Promise</span>.resolve()
</span></span><span style=display:flex><span>  .then(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;promise1&#34;</span>);
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  .then(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;promise2&#34;</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> foo() {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>await</span> bar();
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async1 end&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>foo();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> errorFunc() {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>await</span> <span style=color:#8be9fd;font-style:italic>Promise</span>.reject(<span style=color:#f1fa8c>&#34;error!!!&#34;</span>);
</span></span><span style=display:flex><span>  } <span style=color:#ff79c6>catch</span> (e) {
</span></span><span style=display:flex><span>    console.log(e);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async1&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve(<span style=color:#f1fa8c>&#34;async1 success&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>errorFunc().then((res) =&gt; console.log(res));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> bar() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;async2 end&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;script end&#34;</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>//script start
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async2 end
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//script end
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//promise1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async1 end
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//error!!!
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//promise2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//async1 success
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//setTimeout...
</span></span></span></code></pre></div><hr><h3 id=ç»ƒä¹ 7>ç»ƒä¹ 7</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// ä»£ç è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>console.log(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>setTimeout(() =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>2</span>);
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>3</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>((resolve) =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>4</span>);
</span></span><span style=display:flex><span>    resolve();
</span></span><span style=display:flex><span>  }).then(() =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>5</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>Promise</span>.reject().then(
</span></span><span style=display:flex><span>  () =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>131</span>);
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  () =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>12</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>((resolve) =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>7</span>);
</span></span><span style=display:flex><span>  resolve();
</span></span><span style=display:flex><span>}).then(() =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>8</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>setTimeout(() =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>9</span>);
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>10</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>((resolve) =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>11</span>);
</span></span><span style=display:flex><span>    resolve();
</span></span><span style=display:flex><span>  }).then(() =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>121</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// 1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 7
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 12
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 8
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 4
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 3
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 5
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 9
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 11
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 10
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 121
</span></span></span></code></pre></div><p><strong>è§£æ</strong>ï¼š<a href=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/then>MDN Promise.prototype.then()</a> ğŸ‘ˆ</p><ul><li>then() æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseã€‚å®ƒæœ€å¤šæœ‰ 2 ä¸ªå‚æ•°ï¼šPromiseçš„æˆåŠŸå’Œå¤±è´¥æƒ…å†µçš„å›è°ƒå‡½æ•°ã€‚</li></ul><hr><h3 id=ç»ƒä¹ 8>ç»ƒä¹ 8</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// ä»£ç è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>((resolve, reject) =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    resolve();
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>.then(() =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>((resolve, reject) =&gt; {
</span></span><span style=display:flex><span>        console.log(<span style=color:#bd93f9>3</span>);
</span></span><span style=display:flex><span>        setTimeout(() =&gt; {
</span></span><span style=display:flex><span>            reject();
</span></span><span style=display:flex><span>        }, <span style=color:#bd93f9>3</span> <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>1000</span>);
</span></span><span style=display:flex><span>        resolve();
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .then(() =&gt; {
</span></span><span style=display:flex><span>        console.log(<span style=color:#bd93f9>4</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>((resolve, reject) =&gt; {
</span></span><span style=display:flex><span>            console.log(<span style=color:#bd93f9>5</span>);
</span></span><span style=display:flex><span>            resolve();
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .then(() =&gt; {
</span></span><span style=display:flex><span>            console.log(<span style=color:#bd93f9>7</span>);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .then(() =&gt; {
</span></span><span style=display:flex><span>            console.log(<span style=color:#bd93f9>9</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .then(() =&gt; {
</span></span><span style=display:flex><span>        console.log(<span style=color:#bd93f9>8</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>.then(() =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#bd93f9>6</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// 1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 3
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 4
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 5
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 6
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 7
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 8 
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 9
</span></span></span></code></pre></div><hr><h3 id=ç»ƒä¹ 9>ç»ƒä¹ 9</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// ä»£ç è¾“å‡º
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>setTimeout(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>(<span style=color:#8be9fd;font-style:italic>function</span>(a, b) {
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>2</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd;font-style:italic>var</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>1000</span>; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>    i <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>999</span> <span style=color:#ff79c6>&amp;&amp;</span> a();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>3</span>);
</span></span><span style=display:flex><span>}).then(<span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>  console.log(<span style=color:#bd93f9>4</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#bd93f9>5</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// 2 
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 3
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 5
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 4
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// 1
</span></span></span></code></pre></div><h3 id=ç»ƒä¹ 10>ç»ƒä¹ 10</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> btn <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#39;btn&#39;</span>)
</span></span><span style=display:flex><span>btn.addEventListener(<span style=color:#f1fa8c>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; console.log(<span style=color:#f1fa8c>&#39;m1&#39;</span>))
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#39;listen 1&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btn.addEventListener(<span style=color:#f1fa8c>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; console.log(<span style=color:#f1fa8c>&#39;m2&#39;</span>))
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#39;listen 2&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// btn.click()
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// listen1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// m1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// listen2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// m2
</span></span></span></code></pre></div><p><strong>è§£æ</strong>ï¼šç‚¹å‡»äº‹ä»¶å¼€å¯äº†ä¸‹ä¸€ä¸ªå¾ªç¯ï¼Œæ‰€ä»¥éœ€è¦æŠŠå½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> btn <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#39;btn&#39;</span>)
</span></span><span style=display:flex><span>btn.addEventListener(<span style=color:#f1fa8c>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; console.log(<span style=color:#f1fa8c>&#39;m1&#39;</span>))
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#39;listen 1&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btn.addEventListener(<span style=color:#f1fa8c>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Promise</span>.resolve().then(() =&gt; console.log(<span style=color:#f1fa8c>&#39;m2&#39;</span>))
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#39;listen 2&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btn.click()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// listen1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// listen2
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// m1
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// m2
</span></span></span></code></pre></div><p><strong>è§£æ</strong>ï¼šå› ä¸ºæ˜¯ç›´æ¥è§¦å‘ï¼Œæ‰€ä»¥ä¸¤ä¸ªå‡½æ•°å¤„åœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ã€‚</p><hr><ul class=pager><li class=previous><a href=/post/react/react-router/ data-toggle=tooltip data-placement=top title="React-Router æºç ">&larr;
Previous Post</a></li><li class=next><a href=/post/js/object/ data-toggle=tooltip data-placement=top title=JSä½“ç³»ä¹‹äºŒã€Objectã€‘>Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/qiankun title=qiankun>qiankun</a>
<a href=/tags/raspberrypi title=raspberrypi>raspberrypi</a>
<a href=/tags/ts title=ts>ts</a>
<a href=/tags/%E8%AF%91%E6%96%87 title=è¯‘æ–‡>è¯‘æ–‡</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target=_blank href=https://github.com/chemistwang><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Chemputer Blog"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Chemputer Blog 2023<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>