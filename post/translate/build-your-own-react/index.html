<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Chemputer Blog"><meta property="og:type" content="article"><meta property="og:image" content="https://chemistwang.github.io//img/home-bg.jpg"><meta property="twitter:image" content="https://chemistwang.github.io//img/home-bg.jpg"><meta name=title content="Build Your Own React (è¯‘æ–‡)"><meta property="og:title" content="Build Your Own React (è¯‘æ–‡)"><meta property="twitter:title" content="Build Your Own React (è¯‘æ–‡)"><meta name=description content="ä»é›¶åˆ°ä¸€æ„å»ºè‡ªå·±çš„React"><meta property="og:description" content="ä»é›¶åˆ°ä¸€æ„å»ºè‡ªå·±çš„React"><meta property="twitter:description" content="ä»é›¶åˆ°ä¸€æ„å»ºè‡ªå·±çš„React"><meta property="twitter:card" content="summary"><meta name=keyword content="æ±ªæ´‹é¾™, wangyanglong, Wangyanglong, æ±ªæ´‹é¾™çš„åšå®¢, Wangyanglong Blog, åšå®¢, ä¸ªäººç½‘ç«™, äº’è”ç½‘, Web, Javascript, React"><link rel="shortcut icon" href=/img/favicon.ico><title>Build Your Own React (è¯‘æ–‡) | æ±ªæ´‹é¾™çš„åšå®¢ | Wangyanglong Blog</title><link rel=canonical href=/post/translate/build-your-own-react/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link href=https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css rel=stylesheet type=text/css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>Chemputer Blog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/categories/es6>es6</a></li><li><a href=/categories/react>react</a></li><li><a href=/categories/tech>tech</a></li><li><a href=/categories/threejs>threejs</a></li><li><a href=/archive/>ARCHIVE</a></li><li><a href=/notes/>NOTES</a></li><li><a href=/about/>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/react-bg.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/%E8%AF%91%E6%96%87 title=è¯‘æ–‡>è¯‘æ–‡</a></div><h1>Build Your Own React (è¯‘æ–‡)</h1><h2 class=subheading>ã€Œæºç é˜…è¯»ã€ç¬¬ä¸€å±‚ï¼šæŒæ¡æœ¯è¯­ã€åŸºæœ¬å®ç°æ€è·¯</h2><span class=meta>Posted by
æ±ªæ´‹é¾™
on
Wednesday, September 1, 2021</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><blockquote><p>å‚è€ƒèµ„æ–™:
<a href=https://pomb.us/build-your-own-react/>build-your-own-react</a></p></blockquote><h1 id=æ„å»ºè‡ªå·±çš„-react>æ„å»ºè‡ªå·±çš„ React</h1><p><strong>âš ï¸ã€æ³¨ã€‘å› æœ¬äººæ°´å¹³æœ‰é™ï¼Œéƒ¨åˆ†è¯­å¥ä½¿ç”¨æ„è¯‘ã€‚ä¼šæ ¹æ®æ°´å¹³æå‡åŠæ—¶ä¿®æ­£å®Œå–„ğŸ§</strong></p><p><em>Rodrigo Pombo November 13, 2019</em></p><p>æˆ‘ä»¬å‡†å¤‡ä¸€æ­¥ä¸€æ­¥é‡å†™ <code>React</code>ã€‚ä¸‹é¢çš„æ¶æ„æ¥è‡ª <code>React</code> æºç ï¼Œä½†æŠŠæ‰€æœ‰çš„ä¼˜åŒ–å’Œä¸å¿…è¦çš„åŠŸèƒ½çœç•¥æ‰äº†ã€‚</p><p>å¦‚æœä½ è¯»è¿‡æˆ‘ä¹‹å‰çš„ä¸€ç¯‡å¸–å­ <a href=https://engineering.hexacta.com/didact-learning-how-react-works-by-building-it-from-scratch-51007984e5c5><code>build your own React</code></a>ï¼Œè·Ÿä¸Šä¸€ç¯‡ä¸åŒä¹‹å¤„åœ¨äºè¿™ä¸€ç¯‡åŸºäº <code>React16.8</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>hooks</code>å¹¶ä¸”æŠ›å¼ƒæ‰ç±»ç»„ä»¶ä»£ç </p><p>ä½ å¯ä»¥åœ¨ <a href=https://github.com/pomber/didact><code>è¿™é‡Œ</code></a> æ‰¾åˆ°å®ç°çš„ä»£ç ä»“åº“ï¼Œåœ¨ <a href="https://www.youtube.com/watch?v=8Kc2REHdwnQ&amp;feature=youtu.be&amp;ab_channel=GrUSP"><code>è¿™é‡Œ</code></a> çœ‹åˆ°ç›¸å…³è§†é¢‘</p><p>ä»é›¶å¼€å§‹ï¼Œæˆ‘ä»¬ä¼šä¸€æ­¥ä¸€æ­¥æŠŠè¿™äº›åŠ åˆ°æˆ‘ä»¬çš„<code>React</code>ä¸­</p><ul><li>ç¬¬ä¸€æ­¥ï¼š<code>createElement</code> å‡½æ•°</li><li>ç¬¬äºŒæ­¥ï¼š<code>render</code> å‡½æ•°</li><li>ç¬¬ä¸‰æ­¥ï¼š<code>concurrent</code> æ¨¡å¼</li><li>ç¬¬å››æ­¥ï¼š<code>Fibers</code></li><li>ç¬¬äº”æ­¥ï¼š<code>Render</code> å’Œ <code>Commit</code> é˜¶æ®µ</li><li>ç¬¬å…­æ­¥ï¼š<code>Reconcilation</code></li><li>ç¬¬ä¸ƒæ­¥ï¼š<code>Function</code> ç»„ä»¶</li><li>ç¬¬å…«æ­¥ï¼š<code>Hooks</code></li></ul><h2 id=å‰è¨€>å‰è¨€</h2><p>å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å›é¡¾ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚å¦‚æœä½ å·²ç»çŸ¥é“ <code>React</code>, <code>JSX</code> å’Œ <code>DOM</code> å…ƒç´ å¦‚ä½•è¿è¡Œï¼Œé‚£ä¹ˆå¯ä»¥è·³è¿‡ã€‚</p><p>æˆ‘ä»¬ç”¨ <code>3</code> è¡Œä»£ç å°±å¯ä»¥å¯ç”¨ä¸€ä¸ª <code>React App</code>ã€‚</p><p>ç¬¬ä¸€æ­¥: å®šä¹‰ä¸€ä¸ª <code>React element</code></p><p>ç¬¬äºŒæ­¥: ä» <code>DOM</code> è·å–ä¸€ä¸ªèŠ‚ç‚¹</p><p>ç¬¬ä¸‰æ­¥ï¼šåœ¨ <code>container</code> ä¸­æ¸²æŸ“ <code>React element</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&lt;</span>h1 title<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;foo&#34;</span><span style=color:#ff79c6>&gt;</span>Hello<span style=color:#ff79c6>&lt;</span>/h1&gt;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> container <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;root&#34;</span>)
</span></span><span style=display:flex><span>ReactDOM.render(element, container)
</span></span></code></pre></div><p><strong>è®©æˆ‘ä»¬ç§»é™¤æ‰€æœ‰çš„Reactä»£ç ï¼Œç”¨åŸç”Ÿçš„JavaScriptä»£æ›¿</strong></p><hr><p>ç¬¬ä¸€è¡Œæˆ‘ä»¬ç”¨ <code>JSX</code> å®šä¹‰äº†å…ƒç´ ï¼Œä½†è¿™ä¸æ˜¯æœ‰æ•ˆçš„ <code>Javascript</code>ï¼Œæ‰€ä»¥ä¸ºäº†ç”¨åŸç”Ÿ<code>JS</code>ä»£æ›¿ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»–å˜æˆæœ‰æ•ˆçš„<code>JS</code></p><p><code>JSX</code> æ˜¯é€šè¿‡åƒ <code>Babel</code> è¿™æ ·çš„æ„å»ºå·¥å…·è½¬æ¢æˆ <code>JS</code>ã€‚è¿™ç§è½¬åŒ–é€šå¸¸æ¥è¯´æ¯”è¾ƒç®€å•ï¼šè°ƒç”¨ <code>createElement</code> æ–¹æ³•ï¼ŒæŠŠ <code>æ ‡ç­¾å</code>ã€<code>å±æ€§</code> å’Œå®ƒçš„ <code>å­å…ƒç´ </code> ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p><hr><p><code>React.createElement</code> æ ¹æ®å‚æ•°åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ã€‚é™¤äº†æ ¡éªŒä¹‹å¤–ï¼Œè¿™å°±æ˜¯å®ƒåšçš„å…¨éƒ¨äº†ã€‚æ‰€ä»¥å¯ä»¥å®‰å…¨æ›¿æ¢æ‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> React.createElement(
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;h1&#34;</span>, 
</span></span><span style=display:flex><span>  { title<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;foo&#34;</span> }, 
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;Hello&#34;</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span><span style=color:#6272a4>// const container = document.getElementById(&#34;root&#34;)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// ReactDOM.render(element, container)
</span></span></span></code></pre></div><p>è¿™å°±æ˜¯ä¸€ä¸ªå…ƒç´ çœŸæ­£çš„æ ·å­ï¼Œä¸€ä¸ªå¯¹è±¡åŒ…å«ä¸¤ä¸ªå±æ€§ <code>type</code> å’Œ <code>props</code>ï¼ˆå…¶å®æœ‰<a href=https://github.com/facebook/react/blob/f4cc45ce962adc9f307690e1d5cfa28a288418eb/packages/react/src/ReactElement.js#L111>å¾ˆå¤š</a>ï¼Œæˆ‘ä»¬åªå…³å¿ƒå®ƒä¿©ï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;h1&#34;</span>,
</span></span><span style=display:flex><span>  props<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>    title<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;foo&#34;</span>,
</span></span><span style=display:flex><span>    children<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Hello&#34;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#6272a4>// const container = document.getElementById(&#34;root&#34;)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// ReactDOM.render(element, container)
</span></span></span></code></pre></div><p><code>type</code> å®šä¹‰äº†æˆ‘ä»¬æƒ³è¦åˆ›å»ºä»€ä¹ˆç±»å‹çš„ <code>DOM</code> èŠ‚ç‚¹ï¼Œå°±æ˜¯å½“ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ª <code>HTML</code> å…ƒç´ çš„æ—¶å€™ï¼Œä¼ å…¥ <code>document.createElement</code> æ–¹æ³•çš„ <code>æ ‡ç­¾å</code>ã€‚å®ƒä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸è¿‡æˆ‘ä»¬ä¼šåœ¨ <a href=#%E7%AC%AC%E4%B8%83%E6%AD%A5function%E7%BB%84%E4%BB%B6><strong>ç¬¬ä¸ƒæ­¥</strong></a> è¯´æ˜ã€‚</p><p><code>props</code> æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰æ¥è‡ª <code>JSX</code> çš„å„é¡¹å±æ€§ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼š<code>children</code>ã€‚</p><p><code>children</code> åœ¨å½“å‰è¿™ä¸ªä¾‹å­é‡Œæ˜¯ä¸ª <code>string</code>ï¼Œä½†å¤šæ•°æƒ…å†µæ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå…ƒç´ çš„ <code>array</code>ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¯´å…ƒç´ ä¹Ÿæ˜¯æ ‘ ğŸŒ²ã€‚</p><hr><p>å¦å¤–ä¸€å¤„éœ€è¦æ›¿æ¢çš„ä»£ç æ˜¯ <code>ReactDOM.render</code>ã€‚</p><p><code>render</code> è¡¨ç¤º <code>React</code> ä½œç”¨åœ¨å“ªä¸ª <code>DOM</code> ä¸Šï¼Œé‚£æˆ‘ä»¬ç”¨è‡ªå·±çš„æ–¹å¼å®ç°æ›´æ–°ã€‚</p><hr><p>é¦–å…ˆæˆ‘ä»¬ç”¨å…ƒç´ çš„ <code>type</code> åˆ›å»ºä¸€ä¸ª<code>èŠ‚ç‚¹</code>ï¼Œå½“å‰ä¾‹å­å°±æ˜¯ <code>h1</code>ã€‚</p><p>ç„¶åæˆ‘ä»¬æŠŠæ‰€æœ‰å±æ€§æ”¾åœ¨è¿™ä¸ª <code>èŠ‚ç‚¹</code> é‡Œã€‚å½“å‰åªæœ‰ <code>title</code>ã€‚</p><blockquote><p>ä¸ºäº†é¿å…æ··æ·†ï¼Œæˆ‘ç”¨ <code>element</code> ä»£è¡¨ <code>React</code> å…ƒç´ ï¼Œç”¨ <code>node</code> ä»£è¡¨ <code>DOM</code> å…ƒç´ ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;h1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// props: {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    title<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;foo&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// children: &#34;Hello&#34;,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  },
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#6272a4>// const container = document.getElementById(&#34;root&#34;)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> node <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.createElement(element.type);
</span></span><span style=display:flex><span>node[<span style=color:#f1fa8c>&#34;title&#34;</span>] <span style=color:#ff79c6>=</span> element.props.title;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// const text = document.createTextNode(&#34;&#34;);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// text[&#34;nodeValue&#34;] = element.props.children;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// node.appendChild(text);
</span></span></span></code></pre></div><hr><p>ç„¶åä¸ºå­å…ƒç´ åˆ›å»ºèŠ‚ç‚¹ã€‚æˆ‘ä»¬åªæœ‰ä¸€ä¸ª <code>string</code> ä½œä¸ºå­å…ƒç´ ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ª <code>text node</code></p><p>ä¸ºäº†åœ¨åç»­æ­¥éª¤ä¸­ç”¨åŒä¸€ç§æ–¹æ³•å¤„ç†æ‰€æœ‰å…ƒç´ ï¼Œæˆ‘ä»¬ç”¨ <code>textNode</code> è€Œæ²¡ç”¨<code>innerText</code>ã€‚</p><p>æ³¨æ„ä¸€ä¸‹ï¼Œå°±åƒè®¾ç½® <code>h1</code> çš„ <code>title</code> å±æ€§ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹æ³•è®¾ç½® <code>nodeValue</code>ï¼Œå°±åƒè¿™ä¸ªå­—ç¬¦ä¸²æœ‰äº†å±æ€§ä¸€æ · <code>props: {nodeValue: 'hello'}</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// type: &#34;h1&#34;,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// props: {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//   title: &#34;foo&#34;,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    children<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Hello&#34;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#6272a4>// const container = document.getElementById(&#34;root&#34;)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// const node = document.createElement(element.type);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// node[&#34;title&#34;] = element.props.title;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> text <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.createTextNode(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>text[<span style=color:#f1fa8c>&#34;nodeValue&#34;</span>] <span style=color:#ff79c6>=</span> element.props.children;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// node.appendChild(text);
</span></span></span></code></pre></div><hr><p>æœ€åé¢æŠŠ <code>textNode</code> æ”¾åœ¨ <code>h1</code> ä¸­ï¼Œç„¶åæŠŠ <code>h1</code> æ”¾åˆ° <code>container</code> é‡Œé¢ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// const element = {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   type: &#34;h1&#34;,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   props: {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     title: &#34;foo&#34;,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     children: &#34;Hello&#34;,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   },
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// };
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> container <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;root&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// const node = document.createElement(element.type);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// node[&#34;title&#34;] = element.props.title;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// const text = document.createTextNode(&#34;&#34;);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// text[&#34;nodeValue&#34;] = element.props.children;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>node.appendChild(text);
</span></span><span style=display:flex><span>container.apendChild(node)
</span></span></code></pre></div><hr><p>è¿™ä¸‹å°±å’Œåˆšæ‰ä¸€æ ·äº†ï¼ŒåŒºåˆ«æ˜¯æ²¡æœ‰ç”¨ <code>React</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;h1&#34;</span>,
</span></span><span style=display:flex><span>  props<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>    title<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;foo&#34;</span>,
</span></span><span style=display:flex><span>    children<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Hello&#34;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> container <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;root&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> node <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.createElement(element.type);
</span></span><span style=display:flex><span>node[<span style=color:#f1fa8c>&#34;title&#34;</span>] <span style=color:#ff79c6>=</span> element.props.title;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> text <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.createTextNode(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>text[<span style=color:#f1fa8c>&#34;nodeValue&#34;</span>] <span style=color:#ff79c6>=</span> element.props.children;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>node.appendChild(text);
</span></span><span style=display:flex><span>container.apendChild(node)
</span></span></code></pre></div><hr><h2 id=ç¬¬ä¸€æ­¥createelement-å‡½æ•°>ç¬¬ä¸€æ­¥ï¼š<code>createElement</code> å‡½æ•°</h2><p>æˆ‘ä»¬ä»å¦ä¸€ä¸ª <code>app</code> é‡æ–°å¼€å§‹ã€‚è¿™æ¬¡ç”¨è‡ªå·±å®ç°çš„ <code>React</code>ã€‚</p><p>å…ˆä»å®ç° <code>createElement</code> å¼€å§‹ã€‚</p><p>è®©æˆ‘ä»¬æŠŠ <code>JSX</code> è½¬æ¢ä¸º <code>JS</code>ï¼Œè¿™æ ·å¯ä»¥çœ‹åˆ° <code>createElement</code>çš„è°ƒç”¨ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> (
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;</span>div id<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;foo&#34;</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>a<span style=color:#ff79c6>&gt;</span>bar<span style=color:#ff79c6>&lt;</span>/a&gt;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>b <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> container <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;root&#34;</span>);
</span></span><span style=display:flex><span>ReactDOM.render(element, container);
</span></span></code></pre></div><hr><p>æ­£å¦‚<code>ä¸Šä¸€æ­¥</code>æ‰€çœ‹åˆ°çš„ï¼Œä¸€ä¸ª <code>element</code> æ˜¯ä¸€ä¸ªæœ‰ <code>type</code> å’Œ <code>props</code> çš„å¯¹è±¡ã€‚æˆ‘ä»¬çš„å‡½æ•°åªéœ€è¦åšä¸€ä»¶äº‹ï¼šå°±æ˜¯åˆ›å»ºè¿™ä¸ªå¯¹è±¡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> React.createElement(
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;div&#34;</span>,
</span></span><span style=display:flex><span>  { id<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;foo&#34;</span> },
</span></span><span style=display:flex><span>  React.createElement(<span style=color:#f1fa8c>&#34;a&#34;</span>, <span style=color:#ff79c6>null</span>, <span style=color:#f1fa8c>&#34;bar&#34;</span>),
</span></span><span style=display:flex><span>  React.createElement(<span style=color:#f1fa8c>&#34;b&#34;</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span><span style=color:#6272a4>// const container = document.getElementById(&#34;root&#34;);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// ReactDOM.render(element, container);
</span></span></span></code></pre></div><hr><p>æˆ‘ä»¬å¯¹ <code>props</code> ä½¿ç”¨ <code>å¯¹è±¡æ‰©å±•è¿ç®—ç¬¦</code>ï¼Œå¯¹ <code>children</code> ç”¨ <code>restå‚æ•°è¯­æ³•</code>ï¼Œè¿™æ ·çš„è¯ <code>children</code> å±æ€§å°±ä¼šä¸€ç›´æ˜¯ä¸€ä¸ª <code>array</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> createElement(type, props, ...children) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>    type,
</span></span><span style=display:flex><span>    props<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      ...props,
</span></span><span style=display:flex><span>      children,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¾‹å¦‚ï¼Œ<code>createElement('div')</code> è¿”å›</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;type&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;div&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;props&#34;</span><span style=color:#ff79c6>:</span> { <span style=color:#f1fa8c>&#34;children&#34;</span><span style=color:#ff79c6>:</span> [] }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>createElement("div", null, a)</code>è¿”å›</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;type&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;div&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;props&#34;</span><span style=color:#ff79c6>:</span> { <span style=color:#f1fa8c>&#34;children&#34;</span><span style=color:#ff79c6>:</span> [a] }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>createElement("div", null, a, b)</code>è¿”å›</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;type&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;div&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;props&#34;</span><span style=color:#ff79c6>:</span> { <span style=color:#f1fa8c>&#34;children&#34;</span><span style=color:#ff79c6>:</span> [a, b] }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p><code>children</code> æ•°ç»„å¯èƒ½ä¹Ÿä¼šåŒ…å« <code>string</code> æˆ–è€… <code>numbers</code> è¿™æ ·çš„åŸå§‹å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹è¿™ç±»ä¸æ˜¯å¯¹è±¡çš„å€¼åˆ›å»ºä¸€ä¸ªç‰¹æ®Šç±»å‹ï¼š<code>TEXT_ELEMENT</code></p><blockquote><p>å½“å®ƒä»¬ä¸æ˜¯ <code>children</code>æ—¶ï¼Œ<code>React</code> å¹¶ä¸ä¼šåŒ…è£¹åŸå§‹å€¼æˆ–è€…åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„ã€‚è¿™ä¹ˆåšæ˜¯å› ä¸ºå¯ä»¥ç®€åŒ–ä»£ç ï¼Œå¯¹äºæˆ‘ä»¬çš„å®ç°åº“æ¥è¯´ï¼Œç®€æ´ä¼šæ›´é‡è¦ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// function createElement(type, props, ...children) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   return {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     type,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     props: {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       ...props,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      children<span style=color:#ff79c6>:</span> children.map((child) =&gt;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>typeof</span> child <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;object&#34;</span> 
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>?</span> child
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>:</span> createTextElement(child)
</span></span><span style=display:flex><span>      ),
</span></span><span style=display:flex><span><span style=color:#6272a4>//     },
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   };
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> createTextElement(text) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>    type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;TEXT_ELEMENT&#34;</span>,
</span></span><span style=display:flex><span>    props<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      nodeValue<span style=color:#ff79c6>:</span> text,
</span></span><span style=display:flex><span>      children<span style=color:#ff79c6>:</span> [],
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p>æˆ‘ä»¬ä»ç„¶ç”¨äº† <code>React</code> çš„ <code>createElement</code></p><p>ä¸ºäº†æ›¿æ¢çš„ç›®çš„ï¼Œæˆ‘ä»¬ç»™è‡ªå·±çš„å®ç°åº“èµ·ä¸€ä¸ªåå­—ã€‚</p><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¬ä¸Šå»åƒ <code>React</code> çš„åå­—ï¼ŒåŒæ—¶ä¹Ÿèƒ½è¾¾åˆ° <code>didactic</code> ç›®çš„ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#6272a4>// const element = React.createElement(
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   &#34;div&#34;,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   { id: &#34;foo&#34; },
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  React.createElement(<span style=color:#f1fa8c>&#34;a&#34;</span>, <span style=color:#ff79c6>null</span>, <span style=color:#f1fa8c>&#34;bar&#34;</span>),
</span></span><span style=display:flex><span>  React.createElement(<span style=color:#f1fa8c>&#34;b&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#6272a4>// )
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>...
</span></span></code></pre></div><hr><p>å°±å« <code>Didact</code> å§ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>const</span> Didact <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  createElement,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> Didact.createElement(
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// &#34;div&#34;,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// { id: &#34;foo&#34; },
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  Didact.createElement(<span style=color:#f1fa8c>&#34;a&#34;</span>, <span style=color:#ff79c6>null</span>, <span style=color:#f1fa8c>&#34;bar&#34;</span>),
</span></span><span style=display:flex><span>  Didact.createElement(<span style=color:#f1fa8c>&#34;b&#34;</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p>ä½†æˆ‘ä»¬è¿˜æƒ³åœ¨è¿™ç”¨ <code>JSX</code> è¯­æ³•ï¼Œæ€ä¹ˆå‘Šè¯‰ <code>babel</code> æ˜¯è¦ç”¨ <code>Didact</code> çš„ <code>createElement</code>å‘¢ï¼Ÿ</p><hr><p>å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªåƒè¿™æ ·çš„æ³¨é‡Šï¼Œå½“ <code>babel</code> ç¼–è¯‘çš„æ—¶å€™å°±ä¼šç”¨æˆ‘ä»¬å®šä¹‰çš„å‡½æ•°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>/** @jsx Didact.createElement */</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> (
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;</span>div id<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;foo&#34;</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>a<span style=color:#ff79c6>&gt;</span>bar<span style=color:#ff79c6>&lt;</span>/a&gt;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>b <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h2 id=ç¬¬äºŒæ­¥renderå‡½æ•°>ç¬¬äºŒæ­¥ï¼š<code>render</code>å‡½æ•°</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªè‡ªå·±çš„ <code>ReactDOM.render</code> å‡½æ•°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>...
</span></span><span style=display:flex><span>ReactDOM.render(element, container);
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><hr><p>ç°åœ¨åªè€ƒè™‘å¦‚ä½•æ·»åŠ ï¼Œåé¢å†å»å®ç°æ›´æ–°å’Œåˆ é™¤ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// TODO create dom nodes
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> Didact <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// createElement,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  render
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/** @jsx Didact.createElement */</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> (
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;</span>div id<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;foo&#34;</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>a<span style=color:#ff79c6>&gt;</span>bar<span style=color:#ff79c6>&lt;</span>/a&gt;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>b <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// const container = document.getElementById(&#39;root&#39;);
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Didact.render(element, container);
</span></span></code></pre></div><hr><p>ç”¨ <code>element</code> çš„ <code>type</code> å±æ€§ç”Ÿæˆ <code>DOM</code>ï¼Œç„¶åå°† <code>node</code> è¿½åŠ åˆ° <code>container</code>ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> dom <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.createElement(element.type)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  container.appendChild(dom)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// const Didact = {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   createElement,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   render
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/** @jsx Didact.createElement */</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// const element = (
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   &lt;div id=&#34;foo&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     &lt;a&gt;bar&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     &lt;b /&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// );
</span></span></span></code></pre></div><hr><p>å¯¹æ¯ä¸ª <code>child</code> é€’å½’å°±å¥½äº†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// const dom = document.createElement(element.type)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  
</span></span><span style=display:flex><span>  â€‹element.props.children.forEach(child =&gt;
</span></span><span style=display:flex><span>      render(child, dom)
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// container.appendChild(dom)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// const Didact = {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   createElement,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   render
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/** @jsx Didact.createElement */</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// const element = (
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   &lt;div id=&#34;foo&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     &lt;a&gt;bar&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     &lt;b /&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// );
</span></span></span></code></pre></div><hr><p>æˆ‘ä»¬éœ€è¦å¤„ç†ä¸‹ <code>text</code> å…ƒç´ ï¼Œå¦‚æœç±»å‹æ˜¯ <code>TEXT_ELEMENT</code>ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ª <code>text node</code>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> dom <span style=color:#ff79c6>=</span>
</span></span><span style=display:flex><span>    element.type <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#34;TEXT_ELEMENT&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>?</span> <span style=color:#8be9fd;font-style:italic>document</span>.createTextNode(<span style=color:#f1fa8c>&#34;&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>:</span> <span style=color:#8be9fd;font-style:italic>document</span>.createElement(element.type)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>//   â€‹element.props.children.forEach(child =&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//       render(child, dom)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//   )
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// container.appendChild(dom)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><hr><p>æœ€ååŠ ä¸Š <code>element</code> çš„å±æ€§ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// const dom =
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//   element.type == &#34;TEXT_ELEMENT&#34;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//     ? document.createTextNode(&#34;&#34;)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//     : document.createElement(element.type)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> isProperty <span style=color:#ff79c6>=</span> key =&gt; key <span style=color:#ff79c6>!==</span> <span style=color:#f1fa8c>&#34;children&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Object</span>.keys(element.props)
</span></span><span style=display:flex><span>      .filter(isProperty)
</span></span><span style=display:flex><span>      .forEach(name =&gt; {
</span></span><span style=display:flex><span>        dom[name] <span style=color:#ff79c6>=</span> element.props[name]
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// â€‹element.props.children.forEach(child =&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//     render(child, dom)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// )
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// container.appendChild(dom)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><hr><p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªè‡ªå·±çš„å®ç°åº“ï¼Œå¯ä»¥æŠŠ <code>JSX</code> æ¸²æŸ“åˆ° <code>DOM</code> ä¸Š ã€‚</p><p>åœ¨ <a href=https://codesandbox.io/s/didact-2-k6rbj><code>codesandbox</code></a> ğŸ‘ˆ è¯•è¯•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> createElement(type, props, ...children) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>        type,
</span></span><span style=display:flex><span>        props<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>            ...props,
</span></span><span style=display:flex><span>            children<span style=color:#ff79c6>:</span> children.map(child =&gt;
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>typeof</span> child <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;object&#34;</span> <span style=color:#ff79c6>?</span> child <span style=color:#ff79c6>:</span> createTextElement(child)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> createTextElement(text) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>        type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;TEXT_ELEMENT&#34;</span>,
</span></span><span style=display:flex><span>        props<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>            nodeValue<span style=color:#ff79c6>:</span> text,
</span></span><span style=display:flex><span>            children<span style=color:#ff79c6>:</span> []
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> dom <span style=color:#ff79c6>=</span>
</span></span><span style=display:flex><span>        element.type <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#34;TEXT_ELEMENT&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>?</span> <span style=color:#8be9fd;font-style:italic>document</span>.createTextNode(<span style=color:#f1fa8c>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>:</span> <span style=color:#8be9fd;font-style:italic>document</span>.createElement(element.type);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> isProperty <span style=color:#ff79c6>=</span> key =&gt; key <span style=color:#ff79c6>!==</span> <span style=color:#f1fa8c>&#34;children&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Object</span>.keys(element.props)
</span></span><span style=display:flex><span>        .filter(isProperty)
</span></span><span style=display:flex><span>        .forEach(name =&gt; {
</span></span><span style=display:flex><span>            dom[name] <span style=color:#ff79c6>=</span> element.props[name];
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    element.props.children.forEach(child =&gt; render(child, dom));
</span></span><span style=display:flex><span>    container.appendChild(dom);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> Didact <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    createElement,
</span></span><span style=display:flex><span>    render
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/** @jsx Didact.createElement */</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> (
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>div style<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;background: salmon&#34;</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;</span>h1<span style=color:#ff79c6>&gt;</span>Hello World<span style=color:#ff79c6>&lt;</span>/h1&gt;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;</span>h2 style<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;text-align:right&#34;</span><span style=color:#ff79c6>&gt;</span>from Didact<span style=color:#ff79c6>&lt;</span>/h2&gt;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> container <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;root&#34;</span>);
</span></span><span style=display:flex><span>Didact.render(element, container);
</span></span></code></pre></div><h2 id=ç¬¬ä¸‰æ­¥concurrent-æ¨¡å¼>ç¬¬ä¸‰æ­¥ï¼š<code>Concurrent</code> æ¨¡å¼</h2><p>ä½†&mldr;åœ¨æˆ‘ä»¬æ·»åŠ æ›´å¤šçš„ä»£ç ä¹‹å‰éœ€è¦è¿›è¡Œä¸€æ¬¡é‡æ„ã€‚</p><hr><p>å› ä¸ºåœ¨ <code>é€’å½’</code> çš„è°ƒç”¨ä¸Šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚</p><p>ä¸€æ—¦ç¨‹åºå¼€å§‹ï¼Œåœ¨æ¸²æŸ“æ•´ä¸ª <code>element</code> æ ‘ä¹‹å‰æ˜¯ä¸ä¼šåœä¸‹æ¥çš„ã€‚å¦‚æœ <code>element</code> æ ‘è¿‡äºåºå¤§ï¼Œå®ƒå¯èƒ½ä¼šé•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹ã€‚</p><p>å¦‚æœæµè§ˆå™¨éœ€è¦ä¼˜å…ˆå¤„ç†ï¼Œè¯¸å¦‚ç”¨æˆ·è¾“å…¥æˆ–è€…ä¿æŒä¸æ»‘çš„åŠ¨ç”»æ•ˆæœï¼Œå°±ä¸å¾—ä¸ç­‰å¾…æ¸²æŸ“ç»“æŸã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// const dom =
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//     element.type == &#34;TEXT_ELEMENT&#34;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//         ? document.createTextNode(&#34;&#34;)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//         : document.createElement(element.type);
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// const isProperty = key =&gt; key !== &#34;children&#34;;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// Object.keys(element.props)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//     .filter(isProperty)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//     .forEach(name =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//         dom[name] = element.props[name];
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//     });
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  element.props.children.forEach(child =&gt; 
</span></span><span style=display:flex><span>    render(child, dom)
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// container.appendChild(dom);
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><hr><p>ç°åœ¨æˆ‘ä»¬å‡†å¤‡æŠŠå·¥ä½œæµåˆ‡åˆ†æˆä¸€ä¸ªä¸ªå°çš„å•å…ƒï¼Œå½“æ¯ä¸€ä¸ªå•å…ƒç»“æŸåï¼Œå¦‚æœæœ‰å…¶ä»–éœ€è¦å®Œæˆçš„äº‹æƒ…ï¼Œå°±è®©æµè§ˆå™¨æ‰“æ–­æ¸²æŸ“ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> nextUnitOfWork <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> workLoop(deadline) {
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> shouldYield <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> (nextUnitOfWork <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>!</span>shouldYield) {
</span></span><span style=display:flex><span>    nextUnitOfWork <span style=color:#ff79c6>=</span> performUnitOfWork(
</span></span><span style=display:flex><span>      nextUnitOfWork
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    shouldYield <span style=color:#ff79c6>=</span> deadline.timeRemaining() <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  requestIdleCallback(workLoop)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>requestIdleCallback(workLoop)
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> performUnitOfWork(nextUnitOfWork) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// TODO
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><hr><p>ç”¨ <code>requestIdleCallback</code> å»å®ç°å¾ªç¯ã€‚ä½ å¯ä»¥æŠŠ <code>requestIdleCallback</code> å½“æˆ <code>setTimeout</code>ï¼ŒåŒºåˆ«åœ¨äºæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼Œå½“æµè§ˆå™¨ä¸»çº¿ç¨‹ç©ºé—²çš„æ—¶å€™å®ƒå°±ä¼šæ‰§è¡Œã€‚</p><blockquote><p>React ç°åœ¨<a href=https://github.com/facebook/react/issues/11171#issuecomment-417349573>ä¸å†ç”¨ <code>requestIdleCallback</code></a>ï¼Œè€Œæ˜¯ <a href=https://github.com/facebook/react/tree/main/packages/scheduler><code>schedule package</code></a>ã€‚ä½†å¯¹äºå½“å‰æ¡ˆä¾‹ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// let nextUnitOfWork = null
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> workLoop(deadline) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// let shouldYield = false
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// while (nextUnitOfWork &amp;&amp; !shouldYield) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//   nextUnitOfWork = performUnitOfWork(
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//     nextUnitOfWork
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//   )
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//   shouldYield = deadline.timeRemaining() &lt; 1
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  requestIdleCallback(workLoop)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>requestIdleCallback(workLoop)
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span><span style=color:#6272a4>// function performUnitOfWork(nextUnitOfWork) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// TODO
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// }
</span></span></span></code></pre></div><hr><p><code>requestIdleCallback</code>æœ‰ä¸€ä¸ª <code>deadline</code> å‚æ•°ï¼Œå¯ä»¥ç”¨äºæ£€æŸ¥æµè§ˆå™¨é‡æ–°æŒæ¡æ§åˆ¶æƒä¹‹å‰æˆ‘ä»¬è¿˜æœ‰å¤šå°‘æ—¶é—´ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// let nextUnitOfWork = null
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> workLoop(deadline) {
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> shouldYield <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> (nextUnitOfWork <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>!</span>shouldYield) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>//   nextUnitOfWork = performUnitOfWork(
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//     nextUnitOfWork
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//   )
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    shouldYield <span style=color:#ff79c6>=</span> deadline.timeRemaining() <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// requestIdleCallback(workLoop)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span><span style=color:#6272a4>// requestIdleCallback(workLoop)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>â€‹
</span></span><span style=display:flex><span><span style=color:#6272a4>// function performUnitOfWork(nextUnitOfWork) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// TODO
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// }
</span></span></span></code></pre></div><blockquote><p>æˆªæ­¢2019å¹´11æœˆï¼Œconcurrent æ¨¡å¼ä¸å†ç¨³å®šã€‚ç¨³å®šç‰ˆæœ¬çš„å¾ªç¯æ›´åƒæ˜¯è¿™æ ·</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>while</span> (nextUnitOfWork) {    
</span></span><span style=display:flex><span>  nextUnitOfWork <span style=color:#ff79c6>=</span> performUnitOfWork(   
</span></span><span style=display:flex><span>    nextUnitOfWork  
</span></span><span style=display:flex><span>  ) 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p>åœ¨å¼€å§‹å¾ªç¯ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸‹ç¬¬ä¸€æ¬¡ <code>unit</code>ï¼Œç„¶åå®ç°ä¸€ä¸ª <code>performUnitOfWork</code> å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸ä»…è¦æ‰§è¡Œå½“å‰å•å…ƒçš„ <code>work</code>ï¼Œä¹Ÿéœ€è¦è¿”å›ä¸‹ä¸€ä¸ªå•å…ƒçš„ <code>work</code>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> nextUnitOfWork <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> workLoop(deadline) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// let shouldYield = false
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// while (nextUnitOfWork &amp;&amp; !shouldYield) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    nextUnitOfWork <span style=color:#ff79c6>=</span> performUnitOfWork(
</span></span><span style=display:flex><span>      nextUnitOfWork
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// shouldYield = deadline.timeRemaining() &lt; 1
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// requestIdleCallback(workLoop)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span><span style=color:#6272a4>// requestIdleCallback(workLoop)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>â€‹
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> performUnitOfWork(nextUnitOfWork) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// TODO
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h2 id=ç¬¬å››æ­¥fibers>ç¬¬å››æ­¥ï¼š<code>Fibers</code></h2><p>ä¸ºäº†ç»„ç»‡è¿™äº›å•å…ƒçš„ <code>work</code>ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„ï¼š<code>fiber</code> æ ‘ ğŸŒ²ã€‚</p><p>æ¯ä¸€ä¸ª <code>element</code> éƒ½ä¼šå¯¹åº”ä¸€ä¸ª<code>fiber</code>,æ¯ä¸€ä¸ª <code>fiber</code> ä¹Ÿä¼šå¯¹åº”ä¸€ä¸ª <code>work</code>ã€‚</p><p>ç”¨ä¸€ä¸ªä¾‹å­ ğŸŒ° è¯´æ˜ä¸‹ã€‚</p><p>å‡è®¾æˆ‘ä»¬æƒ³æ¸²æŸ“è¿™æ ·ä¸€æ£µ <code>element</code> æ ‘ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>Didact.render(
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;</span>div<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>h1<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;</span>p <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;</span>a <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>/h1&gt;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>h2 <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&lt;</span>/div&gt;,
</span></span><span style=display:flex><span>  container
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p>åœ¨ <code>render</code> ä¸­ï¼Œæˆ‘ä»¬ä¼šåˆ›å»º <code>root fiber</code>ï¼Œå¹¶å°†å®ƒè®¾ä¸º <code>nextUnitOfWork</code>ã€‚å‰©ä¸‹çš„å·¥ä½œäº¤ç»™ <code>performUnitOfWork</code> å‡½æ•°æ‰§è¡Œã€‚æ¯ä¸€ä¸ª <code>fiber</code> éƒ½è¦åš <code>3</code> ä»¶äº‹ï¼š</p><ol><li><code>DOM</code> ä¸­æ·»åŠ  <code>element</code></li><li>ä¸ºæ¯ä¸€ä¸ª <code>element</code> çš„ <code>children</code> åˆ›å»º <code>fiber</code></li><li>é€‰æ‹©ä¸‹ä¸€ä¸ªå•å…ƒçš„ <code>work</code></li></ol><hr><p>è¿™ç§æ•°æ®ç»“æ„çš„å…¶ä¸­ä¸€ä¸ªç›®çš„æ˜¯æ–¹ä¾¿æ‰¾åˆ° <code>work</code> çš„ä¸‹ä¸€ä¸ªå•å…ƒï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯ä¸€ä¸ª <code>fiber</code> éƒ½éœ€è¦å…³è”å®ƒçš„ <code>first child</code>, <code>next sibling</code> å’Œ <code>parent</code></p><p><img src=/img/build-your-own-react-1.jpg alt=Fiberæ•°ç»“æ„></p><hr><p>å½“æˆ‘ä»¬åœ¨ä¸€ä¸ª <code>fiber</code> å®Œæˆ <code>work</code>æ—¶ï¼Œå¦‚æœå®ƒæœ‰ <code>child</code>ï¼Œå°†ä¼šè¿›è¡Œä¸‹ä¸€ä¸ªå•å…ƒçš„ <code>work</code></p><p>ç”¨æˆ‘ä»¬çš„è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œ<code>div fiber</code> ä¹‹åå°±åˆ°äº† <code>h1 fiber</code></p><hr><p>å¦‚æœå½“å‰ <code>fiber</code> æ²¡æœ‰ <code>child</code>ï¼Œå°±åˆ°äº†å®ƒçš„ <code>sibling</code></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œ<code>p</code> æ²¡æœ‰ <code>child</code>ï¼Œæ‰€ä»¥åœ¨å®ƒå®Œæˆä¹‹åå°±è½®åˆ° <code>a fiber</code></p><hr><p>å¦‚æœæ—¢æ²¡æœ‰ <code>child</code> ä¹Ÿæ²¡æœ‰ <code>sibling</code>ï¼Œå°±ä¼šå»æ‰¾ <code>uncle</code>ï¼Œä¹Ÿå°±æ˜¯ <code>parent sibling</code>ã€‚æ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­çš„ <code>a</code> å’Œ <code>h2</code>ã€‚</p><p>å¦‚æœ <code>parent</code> æ²¡æœ‰ <code>sibling</code>ï¼Œå°±ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æœ‰ <code>sibling</code> æˆ–è€…å¹²è„†åˆ° <code>root</code>ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºåœ¨è¿™æ¬¡ <code>render</code> ä¸­å®Œæˆäº†æ‰€æœ‰çš„ <code>work</code>ã€‚</p><hr><p>ç°åœ¨å¸¦å…¥åˆ°ä»£ç ä¸­ã€‚</p><hr><p>é¦–å…ˆï¼ŒæŠŠ <code>render</code> å‡½æ•°ä¸­çš„ä»£ç ç§»é™¤ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// TODO set next unit of work
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><hr><p>æˆ‘ä»¬ä¿ç•™éƒ¨åˆ†åˆ›å»º <code>DOM</code> èŠ‚ç‚¹çš„ä»£ç ï¼Œç¨åä¼šç”¨åˆ°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> createDom(fiber) {
</span></span><span style=display:flex><span><span style=color:#6272a4>//   const dom =
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     fiber.type == &#34;TEXT_ELEMENT&#34;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       ? document.createTextNode(&#34;&#34;)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       : document.createElement(fiber.type)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   const isProperty = key =&gt; key !== &#34;children&#34;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   Object.keys(fiber.props)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     .filter(isProperty)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     .forEach(name =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       dom[name] = fiber.props[name]
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     })
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   return dom
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><hr><p>åœ¨ <code>render</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç»™ <code>fiber</code> æ ‘çš„ <code>root</code> è®¾ç½® <code>nextUnitOfWork</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>  nextUnitOfWork <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    dom<span style=color:#ff79c6>:</span> container,
</span></span><span style=display:flex><span>    props<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      children<span style=color:#ff79c6>:</span> [element]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> nextUnitOfWork <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>
</span></span></code></pre></div><hr><p>ç„¶åï¼Œå½“æµè§ˆå™¨å‡†å¤‡å¥½äº†ï¼Œå®ƒä¼šæ‰§è¡Œ <code>workLoop</code>ï¼Œæˆ‘ä»¬å°†åœ¨ <code>root</code> å¼€å§‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// let nextUnitOfWork = null
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>â€‹
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> workLoop(deadline) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// let shouldYield = false
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// while (nextUnitOfWork &amp;&amp; !shouldYield) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    nextUnitOfWork <span style=color:#ff79c6>=</span> performUnitOfWork(
</span></span><span style=display:flex><span>      nextUnitOfWork
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// shouldYield = deadline.timeRemaining() &lt; 1
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  }
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// requestIdleCallback(workLoop)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span><span style=color:#6272a4>// requestIdleCallback(workLoop)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>â€‹
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> performUnitOfWork(fiber) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// TODO add dom node
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// TODO create new fibers
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// TODO return next unit of work
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><hr><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>node</code> å¹¶æŠŠå®ƒè¿½åŠ åˆ° <code>DOM</code> ä¸­ã€‚</p><p>å¹¶åœ¨ <code>fiber.dom</code> å±æ€§ä¸­è¿½è¸ª <code>DOM</code> èŠ‚ç‚¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// function performUnitOfWork(fiber) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>fiber.dom) {
</span></span><span style=display:flex><span>    fiber.dom <span style=color:#ff79c6>=</span> createDom(fiber)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (fiber.parent) {
</span></span><span style=display:flex><span>    fiber.parent.dom.appendChild(fiber.dom)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// TODO create new fibers
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// TODO return next unit of work
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><hr><p>ç„¶åå¯¹æ¯ä¸ª <code>child</code> åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>fiber</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// function performUnitOfWork(fiber) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   if (!fiber.dom) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     fiber.dom = createDom(fiber)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   if (fiber.parent) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     fiber.parent.dom.appendChild(fiber.dom)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>const</span> elements <span style=color:#ff79c6>=</span> fiber.props.children
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> index <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> prevSibling <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> (index <span style=color:#ff79c6>&lt;</span> elements.length) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> elements[index]
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> newFiber <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>      type<span style=color:#ff79c6>:</span> element.type,
</span></span><span style=display:flex><span>      props<span style=color:#ff79c6>:</span> element.props,
</span></span><span style=display:flex><span>      parent<span style=color:#ff79c6>:</span> fiber,
</span></span><span style=display:flex><span>      dom<span style=color:#ff79c6>:</span> <span style=color:#ff79c6>null</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// TODO return next unit of work
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><hr><p>ç„¶åæ ¹æ®æƒ…å†µï¼Œæˆ‘ä»¬æŠŠå®ƒä½œä¸º <code>child</code> æˆ–è€…æ˜¯ <code>subling</code> æ¥åŠ åˆ° <code>fiber</code> æ ‘ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// function performUnitOfWork(fiber) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   if (!fiber.dom) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     fiber.dom = createDom(fiber)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   if (fiber.parent) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     fiber.parent.dom.appendChild(fiber.dom)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   const elements = fiber.props.children
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let index = 0
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let prevSibling = null
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   while (index &lt; elements.length) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     const element = elements[index]
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     const newFiber = {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       type: element.type,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       props: element.props,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       parent: fiber,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       dom: null,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (index <span style=color:#ff79c6>===</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>      fiber.child <span style=color:#ff79c6>=</span> newFiber
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>      prevSibling.sibling <span style=color:#ff79c6>=</span> newFiber
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>    prevSibling <span style=color:#ff79c6>=</span> newFiber
</span></span><span style=display:flex><span>    index<span style=color:#ff79c6>++</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// TODO return next unit of work
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><hr><p>æœ€åæˆ‘ä»¬å»æ‰¾ä¸‹ä¸€ä¸ªå•å…ƒçš„ <code>work</code>ã€‚å…ˆæ‰¾ <code>child</code>ï¼Œç„¶åæ˜¯ <code>sibling</code>ï¼Œå†æ˜¯ <code>uncle</code>ï¼Œä»¥æ­¤ç±»æ¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#6272a4>// function performUnitOfWork(fiber) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   if (!fiber.dom) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     fiber.dom = createDom(fiber)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   if (fiber.parent) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     fiber.parent.dom.appendChild(fiber.dom)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   const elements = fiber.props.children
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let index = 0
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let prevSibling = null
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   while (index &lt; elements.length) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     const element = elements[index]
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     const newFiber = {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       type: element.type,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       props: element.props,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       parent: fiber,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       dom: null,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>//     if (index === 0) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       fiber.child = newFiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     } else {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       prevSibling.sibling = newFiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     prevSibling = newFiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     index++
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>if</span> (fiber.child) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> fiber.child
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> nextFiber <span style=color:#ff79c6>=</span> fiber
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> (nextFiber) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (nextFiber.sibling) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> nextFiber.sibling
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    nextFiber <span style=color:#ff79c6>=</span> nextFiber.parent
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p>è¿™å°±æ˜¯æˆ‘ä»¬å…¨éƒ¨çš„ <code>performUnitOfWork</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> performUnitOfWork(fiber) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>fiber.dom) {
</span></span><span style=display:flex><span>    fiber.dom <span style=color:#ff79c6>=</span> createDom(fiber)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (fiber.parent) {
</span></span><span style=display:flex><span>    fiber.parent.dom.appendChild(fiber.dom)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> elements <span style=color:#ff79c6>=</span> fiber.props.children
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> index <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> prevSibling <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> (index <span style=color:#ff79c6>&lt;</span> elements.length) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> elements[index]
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> newFiber <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>      type<span style=color:#ff79c6>:</span> element.type,
</span></span><span style=display:flex><span>      props<span style=color:#ff79c6>:</span> element.props,
</span></span><span style=display:flex><span>      parent<span style=color:#ff79c6>:</span> fiber,
</span></span><span style=display:flex><span>      dom<span style=color:#ff79c6>:</span> <span style=color:#ff79c6>null</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (index <span style=color:#ff79c6>===</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>      fiber.child <span style=color:#ff79c6>=</span> newFiber
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>      prevSibling.sibling <span style=color:#ff79c6>=</span> newFiber
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>    prevSibling <span style=color:#ff79c6>=</span> newFiber
</span></span><span style=display:flex><span>    index<span style=color:#ff79c6>++</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (fiber.child) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> fiber.child
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> nextFiber <span style=color:#ff79c6>=</span> fiber
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> (nextFiber) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (nextFiber.sibling) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> nextFiber.sibling
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    nextFiber <span style=color:#ff79c6>=</span> nextFiber.parent
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>â€‹
</span></span></code></pre></div><h2 id=ç¬¬äº”æ­¥renderå’Œ-commit-é˜¶æ®µ>ç¬¬äº”æ­¥ï¼š<code>Render</code>å’Œ <code>Commit</code> é˜¶æ®µ</h2><p>ç°åœ¨åˆæœ‰å¦ä¸€ä¸ªé—®é¢˜ã€‚</p><p>æ¯æ¬¡ä½œç”¨äºä¸€ä¸ª <code>element</code> æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šç»™ <code>DOM</code> æ·»åŠ ä¸€ä¸ªæ–°çš„ <code>node</code>ã€‚è®°ä½ï¼Œåœ¨æˆ‘ä»¬æ¸²æŸ“æ•´æ£µæ ‘ä¹‹å‰ï¼Œæµè§ˆå™¨å¯ä»¥éšæ—¶æ‰“æ–­æˆ‘ä»¬çš„ <code>work</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ä¸€ä¸ªæ²¡æœ‰å®Œæˆçš„ <code>UI</code>ã€‚è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> performUnitOfWork(fiber) {
</span></span><span style=display:flex><span><span style=color:#6272a4>//   if (!fiber.dom) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     fiber.dom = createDom(fiber)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>â€‹
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (fiber.parent) {
</span></span><span style=display:flex><span>    fiber.parent.dom.appendChild(fiber.dom)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>â€‹
</span></span><span style=display:flex><span><span style=color:#6272a4>//   const elements = fiber.props.children
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let index = 0
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let prevSibling = null
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   while (index &lt; elements.length) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     const element = elements[index]
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     const newFiber = {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       type: element.type,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       props: element.props,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       parent: fiber,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       dom: null,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     if (index === 0) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       fiber.child = newFiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     } else {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       prevSibling.sibling = newFiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     prevSibling = newFiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     index++
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   if (fiber.child) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     return fiber.child
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let nextFiber = fiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   while (nextFiber) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     if (nextFiber.sibling) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       return nextFiber.sibling
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     nextFiber = nextFiber.parent
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>â€‹
</span></span></code></pre></div><hr><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»è¿™å„¿æŠŠå½±å“ <code>DOM</code> çš„è¿™éƒ¨åˆ†ç§»é™¤æ‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> performUnitOfWork(fiber) {
</span></span><span style=display:flex><span><span style=color:#6272a4>//   if (!fiber.dom) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     fiber.dom = createDom(fiber)
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>â€‹
</span></span><span style=display:flex><span><span style=color:#6272a4>//  &gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>â€‹
</span></span><span style=display:flex><span><span style=color:#6272a4>//   const elements = fiber.props.children
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let index = 0
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let prevSibling = null
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   while (index &lt; elements.length) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     const element = elements[index]
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     const newFiber = {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       type: element.type,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       props: element.props,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       parent: fiber,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       dom: null,
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     if (index === 0) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       fiber.child = newFiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     } else {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       prevSibling.sibling = newFiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     prevSibling = newFiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     index++
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// â€‹
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   if (fiber.child) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     return fiber.child
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   let nextFiber = fiber
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   while (nextFiber) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     if (nextFiber.sibling) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//       return nextFiber.sibling
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//     nextFiber = nextFiber.parent
</span></span></span><span style=display:flex><span><span style=color:#6272a4>//   }
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>â€‹
</span></span></code></pre></div><hr><p>åè€Œï¼Œæˆ‘ä»¬è¦ç»§ç»­è¿½è¸ªè¿™ä¸ª <code>fiber</code> æ ‘çš„ <code>root</code>ã€‚æˆ‘ä»¬æŠŠå®ƒå«è¿›è¡Œä¸­çš„ <code>work</code> æˆ–è€…æ˜¯ <code>wipRoot</code>ã€‚</p><blockquote><p>ã€è¯‘è€…æ³¨ã€‘ï¼š<code>wip</code> æ˜¯ <code>work in process</code> çš„ç¼©å†™</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(element, container) {
</span></span><span style=display:flex><span>  wipRoot <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  nextUnitOfWork <span style=color:#ff79c6>=</span> wipRoot;
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>let</span> wipRoot <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p>ä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†æ‰€æœ‰çš„ <code>work</code> (èƒ½ç¡®ä¿çš„åŸå› æ˜¯ä¸ä¼šæœ‰ä¸‹ä¸€ä¸ªå•å…ƒçš„ <code>work</code>) å†å°†æ•´æ£µ <code>fiber</code> æ ‘æäº¤ç»™è¿™ä¸ª <code>DOM</code></p><hr><p>æˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨ <code>commitRoot</code> å‡½æ•°ä¸­ã€‚ç„¶åæˆ‘ä»¬ç»™ <code>dom</code> é€’å½’è¿½åŠ æ‰€æœ‰èŠ‚ç‚¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> commitRoot() {
</span></span><span style=display:flex><span>  commitWork(wipRoot.child)
</span></span><span style=display:flex><span>  wipRoot <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> commitWork(fiber) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>fiber) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> domParent <span style=color:#ff79c6>=</span> fiber.parent.dom
</span></span><span style=display:flex><span>  domParent.appendChild(fiber.dom)
</span></span><span style=display:flex><span>  commitWork(fiber.child)
</span></span><span style=display:flex><span>  commitWork(fiber.sibling)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ç¬¬å…­æ­¥reconciliation>ç¬¬å…­æ­¥ï¼š<code>Reconciliation</code></h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†åœ¨ <code>DOM</code> ä¸­æ·»åŠ çš„æ“ä½œï¼Œé‚£ä¹ˆæ›´æ–°å’Œåˆ é™¤å‘¢ï¼Ÿ</p><p>è¿™å°±æˆ‘ä»¬å‡†å¤‡è¦åšçš„äº‹æƒ…ï¼Œ</p><p>æˆ‘ä»¬éœ€è¦æ‹¿åˆ° <code>render</code> å‡½æ•°æ¥æ”¶åˆ°çš„ <code>elements</code>ï¼Œå»å’Œä¸Šä¸€æ¬¡çš„æäº¤åšå¯¹æ¯”ã€‚</p><hr><p>æ‰€ä»¥åœ¨æäº¤ç»™ <code>DOM</code> ä¹‹åéœ€è¦ä¿å­˜ä¸€ä»½å¼•ç”¨ï¼ŒæŠŠå®ƒç§°ä¸º <code>currentRoot</code>ã€‚</p><p>åŒæ ·æˆ‘ä»¬ç»™æ¯ä¸ª <code>fiber</code> æ·»åŠ ä¸€ä¸ª <code>alternate</code> å±æ€§ã€‚è¿™ä¸ªå±æ€§æŒ‡å‘ <code>old fiber</code>ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šä¸€æ¬¡ <code>commit</code> é˜¶æ®µæäº¤çš„ <code>fiber</code>ã€‚</p><hr><p>ç°åœ¨æˆ‘ä»¬æŠŠåˆ›å»º <code>new fiber</code> çš„ä»£ç ä» <code>performUnitOfWork</code> ä¸­æç‚¼å‡ºæ¥&mldr;</p><p>&mldr;æ”¾åˆ°ä¸€ä¸ªå« <code>reconcileChildren</code> çš„æ–°å‡½æ•°ä¸­ã€‚</p><hr><p>åœ¨è¿™å„¿æˆ‘ä»¬å‡†å¤‡æŠŠ <code>old fiber</code> å’Œ <code>new element</code> åšä¸€ä¸ª <code>reconcile</code>ã€‚</p><hr><p>æˆ‘ä»¬åŒæ—¶é€’å½’ <code>old fiber</code> çš„å­å…ƒç´ ï¼ˆ<code>wipFiber</code> çš„ <code>alternate</code> å±æ€§ï¼‰ï¼Œè¿™ä¸ªæ•°ç»„é‡Œé¢çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬æƒ³è¦ <code>reconcile</code> çš„ã€‚</p><p>å¦‚æœæˆ‘ä»¬åŒæ—¶å¿½ç•¥æ•°ç»„ä¸­éœ€è¦è¿­ä»£çš„æ¨¡ç‰ˆå’Œé“¾è¡¨ï¼Œé‚£åœ¨è¿™ä¸ªå¾ªç¯è¯­å¥ä¸­æˆ‘ä»¬å‰©ä¸‹æœ€å¤šçš„æ˜¯ï¼š<code>oldFiber</code> å’Œ <code>element</code>ã€‚</p><p><strong><code>element</code> æ˜¯æˆ‘ä»¬æƒ³è¦æ¸²æŸ“ç»™ <code>DOM</code> çš„ï¼Œ <code>oldFiber</code> æ˜¯æˆ‘ä»¬æœ€åä¸€æ¬¡æ¸²æŸ“çš„ã€‚</strong></p><p>æˆ‘ä»¬éœ€è¦æ¯”è¾ƒä»–ä»¬ï¼Œå¦‚æœå…¶ä¸­æœ‰å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦å‘èµ·ä¸€æ¬¡ç”³è¯·ã€‚</p><p>ç”¨ <code>type</code> å»æ¯”è¾ƒä»–ä»¬ï¼š</p><ul><li><p>å¦‚æœ <code>old fiber</code> å’Œ <code>new element</code> æœ‰ç›¸åŒçš„ <code>type</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¿ç•™ <code>DOM</code> èŠ‚ç‚¹åªéœ€è¦æ›´æ–°å®ƒçš„ <code>props</code></p></li><li><p>å¦‚æœ <code>type</code> ä¸ä¸€æ ·å¹¶ä¸”æ˜¯ä¸€ä¸ª <code>new element</code>ï¼Œæ„å‘³ç€éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>DOM</code> èŠ‚ç‚¹</p></li><li><p>å¦‚æœ <code>type</code> ä¸ä¸€æ ·å¹¶ä¸”æ˜¯ä¸€ä¸ª <code>old fiber</code>ï¼Œæˆ‘ä»¬éœ€è¦ç§»é™¤è¿™ä¸ªèŠ‚ç‚¹</p></li></ul><blockquote><p>è¿™é‡Œ React ç”¨äº† <code>keys</code> å±æ€§ï¼Œå¯¹äº <code>reconciliation</code> æ¥è¯´ä¼šæ›´å¥½ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ•°ç»„ä¸­æ£€æµ‹å­å…ƒç´ çš„ä½ç½®å˜åŒ–ã€‚</p></blockquote><hr><p>å½“ <code>old fiber</code> å’Œ <code>element</code> æœ‰ç›¸åŒçš„ <code>type</code> æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>new fiber</code> ä¿å­˜æ¥è‡ª <code>old fiber</code> çš„ <code>DOM</code> èŠ‚ç‚¹å’Œæ¥è‡ª <code>element</code> çš„ <code>props</code></p><p>æˆ‘ä»¬ä¹Ÿåœ¨è¿™ä¸ª <code>fiber</code> ä¸­åŠ äº†ä¸€ä¸ªæ–°å±æ€§ï¼š<code>effectTag</code>ã€‚è¿™ä¸ªå°†åœ¨ <code>commit</code> é˜¶æ®µç”¨åˆ°ã€‚</p><hr><p>å¯¹äºè¿™ä¸ªæƒ…å†µæ¥è¯´ï¼Œ <code>element</code> éœ€è¦ä¸€ä¸ªæ–°çš„ <code>DOM</code> èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç”¨ <code>PLACEMENT</code> æ¥æ ‡è®°è¿™ä¸ª <code>new fiber</code>ã€‚</p><hr><p>é‚£å¯¹äºè¿™ä¸ªæƒ…å†µæ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤è¿™ä¸ª <code>node</code>ï¼Œä¹Ÿä¸éœ€è¦ <code>new fiber</code>ï¼Œæ‰€ä»¥åœ¨ <code>old fiber</code> æ ‡è®°ä¸€ä¸ª <code>DELETION</code>ã€‚</p><p>å½“æäº¤ <code>fiber</code> æ ‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ”¾åœ¨æ­£åœ¨ <code>work</code> çš„ <code>root</code> å»åšï¼Œå› ä¸ºå®ƒä¸å­˜åœ¨ <code>old fiber</code></p><hr><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°ç»„å»ç§©åºè·Ÿè¸ªæƒ³è¦ç§»é™¤çš„èŠ‚ç‚¹ã€‚</p><hr><p>ç„¶åï¼Œå½“æˆ‘ä»¬æŠŠå˜åŒ–æäº¤ç»™ <code>DOM</code> æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä»é‚£ä¸ªæ•°ç»„ç”¨è¿™äº› <code>fiber</code>ã€‚</p><hr><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ <code>commitWork</code> å‡½æ•°å»å¤„ç†è¿™äº›æ–°çš„ <code>effectTags</code>ã€‚</p><hr><p>å¦‚æœæ˜¯ <code>PLACEMENT</code>ï¼Œå°±åƒå¾€å¸¸ä¸€æ ·ï¼Œä»çˆ¶çº§çš„ <code>fiber</code> è¿½åŠ  <code>DOM</code> èŠ‚ç‚¹ã€‚</p><hr><p>å¦‚æœæ˜¯ <code>DELETION</code>ï¼Œç›¸åï¼Œç§»é™¤è¿™ä¸ªå­èŠ‚ç‚¹ã€‚</p><hr><p>å¦‚æœæ˜¯ <code>UPDATE</code>ï¼Œæˆ‘ä»¬åœ¨å·²å­˜åœ¨çš„ <code>DOM</code> èŠ‚ç‚¹ä¸Šå»æ›´æ–°å˜åŒ–çš„ <code>prop</code>ã€‚</p><hr><p>æˆ‘ä»¬åœ¨ <code>updateDOM</code> è¿™ä¸ªå‡½æ•°ä¸­å»å¤„ç†ã€‚</p><hr><p>å¯¹æ¯” <code>new fiber</code> å’Œ <code>old fiber</code>ã€‚ç§»é™¤æ²¡æœ‰çš„ <code>prop</code>ï¼Œè®¾ç½®æ–°çš„æˆ–è€…æœ‰å˜åŒ–çš„ <code>prop</code>ã€‚</p><hr><p>å…¶ä¸­ä¸€ä¸ªç‰¹æ®Šçš„ <code>prop</code> éœ€è¦æ›´æ–°æ˜¯ <code>event listener</code>ï¼Œæ‰€ä»¥å¦‚æœè¿™ä¸ªå±æ€§ä»¥ <code>on</code> å¼€å¤´ï¼Œå°±ç‰¹æ®Šå¤„ç†ã€‚</p><hr><p>å¦‚æœ <code>event</code> å¤„ç†å™¨æœ‰å˜åŒ–ï¼Œç§»é™¤ã€‚</p><hr><p>ç„¶åæ·»åŠ ä¸€ä¸ªæ–°çš„å¤„ç†å™¨ã€‚</p><hr><p>åœ¨ <a href=https://codesandbox.io/s/didact-6-96533><code>codesandbox</code></a> ğŸ‘ˆ å°è¯•ä¸€ä¸‹å¸¦æœ‰ <code>reconciliation</code> çš„ç‰ˆæœ¬ã€‚</p><h2 id=ç¬¬ä¸ƒæ­¥functionç»„ä»¶>ç¬¬ä¸ƒæ­¥ï¼š<code>Function</code>ç»„ä»¶</h2><p>ä¸‹é¢éœ€è¦æ·»åŠ çš„æ˜¯ä¸ºäº†æ”¯æŒ <code>Function</code> ç»„ä»¶ã€‚</p><p>æˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸Šåšä¸€äº›ä¿®æ”¹ã€‚ç”¨è¿™ä¸ªç®€å•çš„ <code>function</code> ç»„ä»¶ï¼Œå»è¿”å›ä¸€ä¸ª <code>h1</code> å…ƒç´ ã€‚</p><p>æ³¨æ„å¦‚æœæˆ‘ä»¬æŠŠ <code>JSX</code> è½¬åŒ–ä¸º <code>JS</code>ï¼Œä¼šæ˜¯è¿™æ ·ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> App(props) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> Didact.createElement(
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;h1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>null</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;Hi&#34;</span>,
</span></span><span style=display:flex><span>    props.name
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> Didact.createElement(App,
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  name<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;foo&#34;</span>
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p><code>Function</code> ç»„ä»¶æœ‰ <code>2</code> ä¸ªä¸åŒä¹‹å¤„ï¼š</p><ul><li><p>æ¥è‡ª <code>Function</code> ç»„ä»¶çš„ <code>fiber</code> æ²¡æœ‰ <code>DOM</code> èŠ‚ç‚¹ã€‚</p></li><li><p><code>children</code> æ˜¯ä»å‡½æ•°æ¥çš„è€Œä¸æ˜¯ç›´æ¥ä» <code>props</code> è·å–ã€‚</p></li></ul><hr><p>é‚£æˆ‘ä»¬æ£€æŸ¥ä¸‹ <code>fiber</code> çš„ <code>type</code> æ˜¯å¦æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ ¹æ®è¿™ä¸ªå»å®ç°ä¸åŒçš„æ›´æ–°å‡½æ•°ã€‚</p><p><code>updateHostComponent</code> æˆ‘ä»¬ä¸å˜ã€‚</p><hr><p>åœ¨ <code>updateFunctionComponent</code> æˆ‘ä»¬å»è·å– <code>children</code>ã€‚</p><p>åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>fiber.type</code> æ˜¯ <code>App</code> å‡½æ•°ï¼Œè¿è¡Œä¹‹åè¿”å› <code>h1</code> å…ƒç´ ã€‚</p><p>ç„¶åï¼Œä¸€æ—¦æˆ‘ä»¬è·å–åˆ° <code>children</code>ï¼Œ<code>reconciliation</code> å°±ä¸€æ ·äº†ï¼Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä¸œè¥¿ã€‚</p><hr><p><code>commitWork</code> å‡½æ•°éœ€è¦ä¿®æ”¹ä¸€ä¸‹ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸å¸¦ <code>DOM</code> èŠ‚ç‚¹çš„ <code>fiber</code>ï¼Œéœ€è¦æœ‰ <code>2</code> ä¸ªåœ°æ–¹å˜ä¸€ä¸‹ã€‚</p><hr><p>ç¬¬ä¸€ä¸ªï¼Œä¸ºäº†æ‰¾åˆ°ä¸€ä¸ª <code>DOM</code> çš„çˆ¶çº§ï¼Œæˆ‘ä»¬éœ€è¦å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°ä¸€ä¸ª <code>fiber</code> åŒ…å«ä¸€ä¸ª <code>DOM</code> èŠ‚ç‚¹ã€‚</p><hr><p>å½“æˆ‘ä»¬ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¹Ÿéœ€è¦æ‰¾åˆ°å¸¦æœ‰ <code>DOM</code> èŠ‚ç‚¹çš„å­å…ƒç´ ã€‚</p><h2 id=ç¬¬å…«æ­¥hooks>ç¬¬å…«æ­¥ï¼š<code>Hooks</code></h2><p>åˆ°æœ€åä¸€æ­¥äº†ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº† <code>Function</code> ç»„ä»¶ã€‚
æ·»åŠ ä¸€ä¸‹ <code>state</code>ã€‚</p><hr><p>æŠŠæˆ‘ä»¬çš„ä¾‹å­å˜æˆç»å…¸çš„è®¡æ•°ç»„ä»¶ã€‚æ¯æ¬¡ç‚¹å‡»ï¼Œå®ƒçš„çŠ¶æ€éƒ½ä¼šå¢åŠ ã€‚</p><p>æ³¨æ„ç°åœ¨æˆ‘ä»¬ç”¨ <code>Didact.useState</code> å»è·å–å¹¶æ›´æ–°è®¡æ•°çš„å€¼ã€‚</p><hr><p>è°ƒç”¨ <code>function</code> ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–ä¸€äº›å…¨å±€å˜é‡ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨ <code>useState</code> å‡½æ•°ä¸­å¼•ç”¨ã€‚</p><p>åŒæ—¶ä¹Ÿç»™ <code>fiber</code> æ·»åŠ äº†ä¸€ä¸ª <code>hooks</code> æ•°ç»„ï¼Œç›®çš„æ˜¯æ”¯æŒåœ¨ç›¸åŒç»„ä»¶å†…å¤šæ¬¡è°ƒç”¨ <code>useState</code>ã€‚å¹¶ä¸”æˆ‘ä»¬ä¼šæŒç»­è¿½è¸ªå½“å‰ <code>hook</code> çš„ç´¢å¼•ã€‚</p><hr><p>å½“æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>old hook</code>ï¼Œå¹¶ä¸”æˆ‘ä»¬æ²¡æœ‰åˆå§‹åŒ–è¿™ä¸ª <code>state</code>ï¼Œé‚£ä¹ˆå°±æŠŠ <code>old hook</code> çš„ <code>state</code> æ‹·è´åˆ° <code>new hook</code>ã€‚</p><p>å½“æˆ‘ä»¬åœ¨ <code>fiber</code> æ–°å¢ä¸€ä¸ª <code>new hook</code>ï¼Œé‚£ä¹ˆä¸€ä¸ªä¸€ä¸ªå¢åŠ  <code>hook</code> çš„ç´¢å¼•ï¼Œç„¶åè¿”å›è¿™ä¸ª <code>state</code>ã€‚</p><hr><p><code>useState</code> ä¹Ÿåº”è¯¥è¿”å›ä¸€ä¸ªå¯ä»¥æ›´æ–° <code>state</code> çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰ <code>setState</code> å‡½æ•°å»æ¥å—ä¸€ä¸ªè¡Œä¸ºã€‚ï¼ˆåœ¨è®¡æ•°è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™ä¸ªè¡Œä¸ºå°±æ˜¯å¢åŠ çš„å‡½æ•°ï¼‰</p><p>æˆ‘ä»¬æŠŠè¿™ä¸ª <code>action</code> è¿½åŠ åˆ°ä¸€ä¸ªå·²ç»æ·»åŠ åœ¨ <code>hook</code> çš„é˜Ÿåˆ—ä¸­ã€‚</p><p>ç„¶åæˆ‘ä»¬åœ¨ <code>render</code> å‡½æ•°ä¸­åšä¸€äº›ç›¸ä¼¼çš„äº‹å„¿ï¼Œåœ¨å·¥ä½œçš„æ ¹èŠ‚ç‚¹ä¸­è®¾ç½®ä¸€ä¸ªæ–°çš„ <code>work</code> ä½œä¸ºä¸‹ä¸€ä¸ªå•å…ƒçš„ <code>work</code>ï¼Œè¿™æ · <code>work</code> å¾ªç¯å¯ä»¥å¼€å§‹ä¸€ä¸ªæ–°çš„ <code>render</code> é˜¶æ®µã€‚</p><hr><p>ç„¶è€Œæˆ‘ä»¬æ²¡æœ‰è¿è¡Œè¿™ä¸ª <code>action</code>ã€‚</p><p>åœ¨ä¸‹æ¬¡æ¸²æŸ“ç»„ä»¶çš„æ—¶å€™å†å»åšï¼Œä» <code>old hook</code> çš„é˜Ÿåˆ—ä¸­æŠŠæ‰€æœ‰çš„ <code>action</code> æ‹¿å‡ºæ¥ï¼Œç„¶ååœ¨ <code>new hook</code> çŠ¶æ€ä¸­ä¸€ä¸ªä¸€ä¸ªå»æ‰§è¡Œï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¿”å› <code>state</code> çš„æ—¶å€™ï¼Œå®ƒå°±æ›´æ–°äº†ã€‚</p><hr><p>é‚£è¿™å°±æ˜¯å…¨éƒ¨äº†ï¼Œæˆ‘ä»¬å·²ç»æ„å»ºäº†è‡ªå·±çš„ <code>React</code>ã€‚</p><p>ä½ å¯ä»¥åœ¨ <a href=https://codesandbox.io/s/didact-8-21ost><code>codesandbox</code></a> ğŸ‘ˆ æˆ–è€… <a href=https://github.com/pomber/didact><code>github</code></a> ğŸ‘ˆ è¯•è¯•ã€‚</p><h2 id=ç»“è¯­>ç»“è¯­</h2><p>é™¤äº†å¸®ä½ ç†è§£<code>React</code>æ˜¯æ€ä¹ˆå®ç°ä¹‹å¤–ï¼Œå…¶ä¸­ä¸€ä¸ªç›®çš„æ˜¯æƒ³è®©ä½ æ›´æ·±å…¥çš„ç†è§£ <code>React</code> æºç ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ç»å¸¸ç”¨ä¸€äº›ç›¸åŒçš„å˜é‡åå’Œå‡½æ•°åã€‚</p><p>ä¸¾ä¸ªä¾‹å­ ğŸŒ° ï¼Œå¦‚æœåœ¨çœŸå®çš„ <code>React app</code> ä¸­è°ƒè¯•ä½ çš„ <code>function</code> ç»„ä»¶ï¼Œè°ƒç”¨æ ˆä¼šæ˜¾ç¤ºï¼š</p><ul><li><code>workLoop</code></li><li><code>performUnitOfWork</code></li><li><code>updateFunctionComponent</code></li></ul><p>æˆ‘ä»¬æ²¡æœ‰åŒ…å«å¾ˆå¤š <code>React</code> çš„ç‰¹æ€§å’Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ ğŸ‘‡ è¿™äº›å°±å’Œ<code>React</code>ä¸­ä¸ä¸€æ ·ã€‚</p><ul><li><p>åœ¨ <code>Didact</code> ä¸­ï¼Œ<code>render</code> é˜¶æ®µéå†äº†æ•´æ£µæ ‘ ğŸŒ²ã€‚è€Œ <code>React</code> ä¼šæ ¹æ®ä¸€äº›ç­–ç•¥è·³è¿‡é‚£äº›æ²¡æœ‰æ”¹å˜çš„å­æ ‘ ğŸŒ²</p></li><li><p>åœ¨ <code>commit</code> é˜¶æ®µï¼Œæˆ‘ä»¬åŒæ ·éå†äº†æ•´æ£µæ ‘ ğŸŒ²ã€‚ä¸è¿‡ <code>React</code> ç”¨ä¸€ä¸ªé“¾è¡¨ä¿å­˜äº†å—å½±å“çš„ <code>fiber</code> å¹¶ä¸”åªä¼šè®¿é—®è¿™äº› <code>fiber</code></p></li><li><p>æ¯æ¬¡æˆ‘ä»¬æ„å»ºæ–°çš„ <code>work</code> æ—¶ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ª <code>fiber</code> éƒ½åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <code>object</code>ã€‚<code>React</code> ä¼šå›æ”¶è¿™äº›ä¹‹å‰æ ‘ä¸Šçš„ <code>fiber</code></p></li><li><p>åœ¨ <code>render</code> é˜¶æ®µï¼Œå½“ <code>Didact</code> æ”¶åˆ°æ›´æ–°æ—¶ï¼Œå®ƒä¼šæŠ›å¼ƒæ‰æ­£åœ¨è¿›è¡Œçš„ <code>work</code> å¹¶ä¸”ä» <code>root</code> é‡æ–°å¼€å§‹ã€‚<code>React</code> ç”¨è¿‡æœŸæ—¶é—´æ ‡è®°äº†æ¯ä¸ªæ›´æ–°ï¼Œ å¹¶ä¸”ç”¨å®ƒä»¬æ¥å†³å®šå“ªä¸ªæ›´æ–°æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚</p></li><li><p>å…¶å®è¿˜æœ‰æ›´å¤š&mldr;</p></li></ul><p>ä½ ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çš„åŠ ä¸€äº›ç‰¹æ€§ï¼š</p><ul><li>æŠŠ <code>object</code> ç”¨åœ¨æ ·å¼å±æ€§ä¸Š</li><li><a href=https://github.com/pomber/didact/issues/11>æ‰å¹³åŒ–å­æ•°ç»„</a> ğŸ‘ˆ</li><li><code>useEffect</code> çš„ <code>hook</code> ç‰¹æ€§</li><li>é€šè¿‡ <code>key</code> å®ç° <code>reconciliation</code></li></ul><p>å¦‚æœä½ æŠŠè¿™äº›æˆ–è€…å…¶ä»–ç‰¹æ€§åŠ åˆ° <code>Didact</code> ä¸­ï¼Œç»™ <a href=https://github.com/pomber/didact>GitHub ä»“åº“</a> ğŸ‘ˆ å‘é€ä¸€ä¸ª <code>PR</code>ï¼Œè¿™æ ·å…¶ä»–äººå°±èƒ½çœ‹è§äº†ã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼</p><hr><ul class=pager><li class=previous><a href=/post/js/sentry/ data-toggle=tooltip data-placement=top title>&larr;
Previous Post</a></li><li class=next><a href=/post/brew-error/ data-toggle=tooltip data-placement=top title="Brew: Version value must be a string; got a NilClass">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/qiankun title=qiankun>qiankun</a>
<a href=/tags/raspberrypi title=raspberrypi>raspberrypi</a>
<a href=/tags/ts title=ts>ts</a>
<a href=/tags/%E8%AF%91%E6%96%87 title=è¯‘æ–‡>è¯‘æ–‡</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target=_blank href=https://github.com/chemistwang><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Chemputer Blog"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Chemputer Blog 2023<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>